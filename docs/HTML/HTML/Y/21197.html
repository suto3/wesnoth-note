<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>unit_to_harm</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.5.6' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<pre>
<span class='curline'><a href='../S/5539.html#L24'>unit_to_harm</a>       24 data/lua/wml/harm_unit.lua 	for index, unit_to_harm in ipairs(wesnoth.get_units(filter)) do</span>
<span class='curline'><a href='../S/5539.html#L25'>unit_to_harm</a>       25 data/lua/wml/harm_unit.lua 		if unit_to_harm.valid then</span>
<span class='curline'><a href='../S/5539.html#L28'>unit_to_harm</a>       28 data/lua/wml/harm_unit.lua 			wesnoth.set_variable("this_unit", unit_to_harm.__cfg) -- cfg field needed</span>
<span class='curline'><a href='../S/5539.html#L52'>unit_to_harm</a>       52 data/lua/wml/harm_unit.lua 						T.facing { x = unit_to_harm.x, y = unit_to_harm.y },</span>
<span class='curline'><a href='../S/5539.html#L55'>unit_to_harm</a>       55 data/lua/wml/harm_unit.lua 				wesnoth.scroll_to_tile(unit_to_harm.x, unit_to_harm.y, true)</span>
<span class='curline'><a href='../S/5539.html#L92'>unit_to_harm</a>       92 data/lua/wml/harm_unit.lua 				wesnoth.get_time_of_day( { unit_to_harm.x, unit_to_harm.y, true } ).lawful_bonus,</span>
<span class='curline'><a href='../S/5539.html#L93'>unit_to_harm</a>       93 data/lua/wml/harm_unit.lua 				wesnoth.unit_resistance( unit_to_harm, cfg.damage_type or "dummy" ),</span>
<span class='curline'><a href='../S/5539.html#L97'>unit_to_harm</a>       97 data/lua/wml/harm_unit.lua 			if unit_to_harm.hitpoints &lt;= damage then</span>
<span class='curline'><a href='../S/5539.html#L98'>unit_to_harm</a>       98 data/lua/wml/harm_unit.lua 				if kill == false then damage = unit_to_harm.hitpoints - 1</span>
<span class='curline'><a href='../S/5539.html#L99'>unit_to_harm</a>       99 data/lua/wml/harm_unit.lua 				else damage = unit_to_harm.hitpoints</span>
<span class='curline'><a href='../S/5539.html#L103'>unit_to_harm</a>      103 data/lua/wml/harm_unit.lua 			unit_to_harm.hitpoints = unit_to_harm.hitpoints - damage</span>
<span class='curline'><a href='../S/5539.html#L106'>unit_to_harm</a>      106 data/lua/wml/harm_unit.lua 			local gender = unit_to_harm.__cfg.gender</span>
<span class='curline'><a href='../S/5539.html#L109'>unit_to_harm</a>      109 data/lua/wml/harm_unit.lua 				if not cfg[name] or unit_to_harm.status[name] then return end</span>
<span class='curline'><a href='../S/5539.html#L116'>unit_to_harm</a>      116 data/lua/wml/harm_unit.lua 				unit_to_harm.status[name] = true</span>
<span class='curline'><a href='../S/5539.html#L124'>unit_to_harm</a>      124 data/lua/wml/harm_unit.lua 			if not unit_to_harm.status.unpoisonable then</span>
<span class='curline'><a href='../S/5539.html#L132'>unit_to_harm</a>      132 data/lua/wml/harm_unit.lua 			wesnoth.extract_unit(unit_to_harm)</span>
<span class='curline'><a href='../S/5539.html#L133'>unit_to_harm</a>      133 data/lua/wml/harm_unit.lua 			wesnoth.put_unit(unit_to_harm)</span>
<span class='curline'><a href='../S/5539.html#L145'>unit_to_harm</a>      145 data/lua/wml/harm_unit.lua 						T.filter { id = unit_to_harm.id },</span>
<span class='curline'><a href='../S/5539.html#L155'>unit_to_harm</a>      155 data/lua/wml/harm_unit.lua 						T.filter { id = unit_to_harm.id },</span>
<span class='curline'><a href='../S/5539.html#L162'>unit_to_harm</a>      162 data/lua/wml/harm_unit.lua 			wesnoth.float_label( unit_to_harm.x, unit_to_harm.y, string.format( "&lt;span foreground='red'&gt;%s&lt;/span&gt;", text ) )</span>
<span class='curline'><a href='../S/5539.html#L169'>unit_to_harm</a>      169 data/lua/wml/harm_unit.lua 			if experience ~= false and harmer and harmer.valid and wesnoth.is_enemy( unit_to_harm.side, harmer.side ) then -- no XP earned for harming friendly units</span>
<span class='curline'><a href='../S/5539.html#L170'>unit_to_harm</a>      170 data/lua/wml/harm_unit.lua 				if kill ~= false and unit_to_harm.hitpoints &lt;= 0 then</span>
<span class='curline'><a href='../S/5539.html#L171'>unit_to_harm</a>      171 data/lua/wml/harm_unit.lua 					harmer.experience = harmer.experience + calc_xp( unit_to_harm.__cfg.level )</span>
<span class='curline'><a href='../S/5539.html#L173'>unit_to_harm</a>      173 data/lua/wml/harm_unit.lua 					unit_to_harm.experience = unit_to_harm.experience + harmer.__cfg.level</span>
<span class='curline'><a href='../S/5539.html#L174'>unit_to_harm</a>      174 data/lua/wml/harm_unit.lua 					harmer.experience = harmer.experience + unit_to_harm.__cfg.level</span>
<span class='curline'><a href='../S/5539.html#L178'>unit_to_harm</a>      178 data/lua/wml/harm_unit.lua 			if kill ~= false and unit_to_harm.hitpoints &lt;= 0 then</span>
<span class='curline'><a href='../S/5539.html#L179'>unit_to_harm</a>      179 data/lua/wml/harm_unit.lua 				wml_actions.kill { id = unit_to_harm.id, animate = toboolean( animate ), fire_event = fire_event }</span>
<span class='curline'><a href='../S/5539.html#L191'>unit_to_harm</a>      191 data/lua/wml/harm_unit.lua 			if experience ~= false and unit_to_harm and unit_to_harm.valid then</span>
<span class='curline'><a href='../S/5539.html#L192'>unit_to_harm</a>      192 data/lua/wml/harm_unit.lua 				unit_to_harm:advance(toboolean(animate), fire_event ~= false)</span>
</pre>
</body>
</html>
