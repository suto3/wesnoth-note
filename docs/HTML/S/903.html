<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>src/actions/undo.cpp</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.5.6' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<a id='TOP' name='TOP'></a><h2 class='header'><a href='../mains.html'>root</a>/<a href='../files/5826.html'>src</a>/<a href='../files/5828.html'>actions</a>/undo.cpp</h2>
<em class='comment'>/* [&lt;][&gt;]<a href='#L71'>[^]</a><a href='#L440'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
<hr />
<h2 class='header'>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L71' title='Defined at 71.'>create_action</a></li>
<li><a href='#L125' title='Defined at 125.'>committed_actions_</a></li>
<li><a href='#L144' title='Defined at 144.'>add_auto_shroud</a></li>
<li><a href='#L152' title='Defined at 152.'>add_dummy</a></li>
<li><a href='#L163' title='Defined at 163.'>add_dismissal</a></li>
<li><a href='#L171' title='Defined at 171.'>add_move</a></li>
<li><a href='#L183' title='Defined at 183.'>add_recall</a></li>
<li><a href='#L192' title='Defined at 192.'>add_recruit</a></li>
<li><a href='#L203' title='Defined at 203.'>add_update_shroud</a></li>
<li><a href='#L218' title='Defined at 218.'>clear</a></li>
<li><a href='#L241' title='Defined at 241.'>commit_vision</a></li>
<li><a href='#L260' title='Defined at 260.'>new_side_turn</a></li>
<li><a href='#L286' title='Defined at 286.'>read</a></li>
<li><a href='#L330' title='Defined at 330.'>write</a></li>
<li><a href='#L397' title='Defined at 397.'>redo</a></li>
<li><a href='#L440' title='Defined at 440.'>apply_shroud_changes</a></li>
</ol>
<hr />
<pre>
<a id='L1' name='L1'></a>   1 <em class='comment'>/*</em>
<a id='L2' name='L2'></a>   2 <em class='comment'>   Copyright (C) 2003 - 2017 by David White &lt;dave@whitevine.net&gt;</em>
<a id='L3' name='L3'></a>   3 <em class='comment'>   Part of the Battle for Wesnoth Project http://www.wesnoth.org/</em>
<a id='L4' name='L4'></a>   4 <em class='comment'></em>
<a id='L5' name='L5'></a>   5 <em class='comment'>   This program is free software; you can redistribute it and/or modify</em>
<a id='L6' name='L6'></a>   6 <em class='comment'>   it under the terms of the GNU General Public License as published by</em>
<a id='L7' name='L7'></a>   7 <em class='comment'>   the Free Software Foundation; either version 2 of the License, or</em>
<a id='L8' name='L8'></a>   8 <em class='comment'>   (at your option) any later version.</em>
<a id='L9' name='L9'></a>   9 <em class='comment'>   This program is distributed in the hope that it will be useful,</em>
<a id='L10' name='L10'></a>  10 <em class='comment'>   but WITHOUT ANY WARRANTY.</em>
<a id='L11' name='L11'></a>  11 <em class='comment'></em>
<a id='L12' name='L12'></a>  12 <em class='comment'>   See the COPYING file for more details.</em>
<a id='L13' name='L13'></a>  13 <em class='comment'>*/</em>
<a id='L14' name='L14'></a>  14 
<a id='L15' name='L15'></a>  15 <em class='comment'>/**</em>
<a id='L16' name='L16'></a>  16 <em class='comment'> * @file</em>
<a id='L17' name='L17'></a>  17 <em class='comment'> * Undoing, redoing.</em>
<a id='L18' name='L18'></a>  18 <em class='comment'> */</em>
<a id='L19' name='L19'></a>  19 
<a id='L20' name='L20'></a>  20 <em class='sharp'>#include</em> "<a href='910.html'>actions/undo.hpp</a>"
<a id='L21' name='L21'></a>  21 
<a id='L22' name='L22'></a>  22 <em class='sharp'>#include</em> "<a href='140.html'>game_board.hpp</a>"               <em class='comment'>// for game_board</em>
<a id='L23' name='L23'></a>  23 <em class='sharp'>#include</em> "<a href='745.html'>game_display.hpp</a>"          <em class='comment'>// for game_display</em>
<a id='L24' name='L24'></a>  24 <em class='sharp'>#include</em> "<a href='../I/2027.html'>log.hpp</a>"                   <em class='comment'>// for LOG_STREAM, logger, etc</em>
<a id='L25' name='L25'></a>  25 <em class='sharp'>#include</em> "<a href='../I/2434.html'>map/map.hpp</a>"                      <em class='comment'>// for gamemap</em>
<a id='L26' name='L26'></a>  26 <em class='sharp'>#include</em> "<a href='1096.html'>map/location.hpp</a>"  <em class='comment'>// for map_location, operator&lt;&lt;, etc</em>
<a id='L27' name='L27'></a>  27 <em class='sharp'>#include</em> "<a href='971.html'>mouse_handler_base.hpp</a>"       <em class='comment'>// for command_disabler</em>
<a id='L28' name='L28'></a>  28 <em class='sharp'>#include</em> "<a href='../I/2488.html'>preferences/general.hpp</a>"
<a id='L29' name='L29'></a>  29 <em class='sharp'>#include</em> "<a href='1051.html'>recall_list_manager.hpp</a>"   <em class='comment'>// for recall_list_manager</em>
<a id='L30' name='L30'></a>  30 <em class='sharp'>#include</em> "<a href='834.html'>replay.hpp</a>"                <em class='comment'>// for recorder, replay</em>
<a id='L31' name='L31'></a>  31 <em class='sharp'>#include</em> "<a href='972.html'>replay_helper.hpp</a>"         <em class='comment'>// for replay_helper</em>
<a id='L32' name='L32'></a>  32 <em class='sharp'>#include</em> "<a href='678.html'>resources.hpp</a>"             <em class='comment'>// for screen, teams, units, etc</em>
<a id='L33' name='L33'></a>  33 <em class='sharp'>#include</em> "<a href='747.html'>synced_context.hpp</a>"        <em class='comment'>// for set_scontext_synced</em>
<a id='L34' name='L34'></a>  34 <em class='sharp'>#include</em> "<a href='1080.html'>team.hpp</a>"                  <em class='comment'>// for team</em>
<a id='L35' name='L35'></a>  35 <em class='sharp'>#include</em> "<a href='994.html'>units/unit.hpp</a>"                  <em class='comment'>// for unit</em>
<a id='L36' name='L36'></a>  36 <em class='sharp'>#include</em> "<a href='990.html'>units/animation_component.hpp</a>"
<a id='L37' name='L37'></a>  37 <em class='sharp'>#include</em> "<a href='1011.html'>units/id.hpp</a>"
<a id='L38' name='L38'></a>  38 <em class='sharp'>#include</em> "<a href='../I/2434.html'>units/map.hpp</a>"              <em class='comment'>// for unit_map, etc</em>
<a id='L39' name='L39'></a>  39 <em class='sharp'>#include</em> "<a href='993.html'>units/ptr.hpp</a>"      <em class='comment'>// for unit_const_ptr, unit_ptr</em>
<a id='L40' name='L40'></a>  40 <em class='sharp'>#include</em> "<a href='1020.html'>units/types.hpp</a>"               <em class='comment'>// for unit_type, unit_type_data, etc</em>
<a id='L41' name='L41'></a>  41 <em class='sharp'>#include</em> "<a href='../I/1640.html'>whiteboard/manager.hpp</a>"    <em class='comment'>// for manager</em>
<a id='L42' name='L42'></a>  42 
<a id='L43' name='L43'></a>  43 <em class='sharp'>#include</em> "<a href='884.html'>actions/create.hpp</a>"                   <em class='comment'>// for find_recall_location, etc</em>
<a id='L44' name='L44'></a>  44 <em class='sharp'>#include</em> "<a href='../I/1614.html'>actions/move.hpp</a>"                   <em class='comment'>// for get_village</em>
<a id='L45' name='L45'></a>  45 <em class='sharp'>#include</em> "<a href='891.html'>actions/vision.hpp</a>"           <em class='comment'>// for clearer_info, etc</em>
<a id='L46' name='L46'></a>  46 <em class='sharp'>#include</em> "<a href='885.html'>actions/shroud_clearing_action.hpp</a>"
<a id='L47' name='L47'></a>  47 <em class='sharp'>#include</em> "<a href='883.html'>actions/undo_dismiss_action.hpp</a>"
<a id='L48' name='L48'></a>  48 <em class='sharp'>#include</em> "<a href='898.html'>actions/undo_move_action.hpp</a>"
<a id='L49' name='L49'></a>  49 <em class='sharp'>#include</em> "<a href='894.html'>actions/undo_recall_action.hpp</a>"
<a id='L50' name='L50'></a>  50 <em class='sharp'>#include</em> "<a href='886.html'>actions/undo_recruit_action.hpp</a>"
<a id='L51' name='L51'></a>  51 <em class='sharp'>#include</em> "<a href='893.html'>actions/undo_update_shroud_action.hpp</a>"
<a id='L52' name='L52'></a>  52 
<a id='L53' name='L53'></a>  53 <em class='sharp'>#include</em> &lt;algorithm&gt;                    <em class='comment'>// for reverse</em>
<a id='L54' name='L54'></a>  54 <em class='sharp'>#include</em> &lt;cassert&gt;                      <em class='comment'>// for assert</em>
<a id='L55' name='L55'></a>  55 <em class='sharp'>#include</em> &lt;ostream&gt;                      <em class='comment'>// for operator&lt;&lt;, basic_ostream, etc</em>
<a id='L56' name='L56'></a>  56 <em class='sharp'>#include</em> &lt;set&gt;                          <em class='comment'>// for set</em>
<a id='L57' name='L57'></a>  57 
<a id='L58' name='L58'></a>  58 <strong class='reserved'>static</strong> <a href='../D/9803.html' title='Multiple defined in 5 places.'>lg</a>::<a href='../D/10014.html' title='Multiple defined in 2 places.'>log_domain</a> <a href='../Y/13471.html' title='Multiple used in 194 places.'>log_engine</a>("engine");
<a id='L59' name='L59'></a>  59 <em class='sharp'>#define</em> <a href='../R/415.html' title='Multiple referred from 101 places.'>ERR_NG</a> <a href='../S/660.html#L187' title='Defined at 187 in src/log.hpp.'>LOG_STREAM</a>(<a href='../S/847.html#L78' title='Defined at 78 in src/log.cpp.'>err</a>, <a href='../Y/13471.html' title='Multiple used in 194 places.'>log_engine</a>)
<a id='L60' name='L60'></a>  60 <em class='sharp'>#define</em> <a href='../R/995.html' title='Multiple referred from 132 places.'>LOG_NG</a> <a href='../S/660.html#L187' title='Defined at 187 in src/log.hpp.'>LOG_STREAM</a>(<a href='../D/8855.html' title='Multiple defined in 2 places.'>info</a>, <a href='../Y/13471.html' title='Multiple used in 194 places.'>log_engine</a>)
<a id='L61' name='L61'></a>  61 
<a id='L62' name='L62'></a>  62 
<a id='L63' name='L63'></a>  63 <strong class='reserved'>namespace</strong> <a href='../R/2533.html' title='Multiple referred from 129 places.'>actions</a> <em class='brace'>{</em>
<a id='L64' name='L64'></a>  64 
<a id='L65' name='L65'></a>  65 
<a id='L66' name='L66'></a>  66 
<a id='L67' name='L67'></a>  67 <em class='comment'>/**</em>
<a id='L68' name='L68'></a>  68 <em class='comment'> * Creates an undo_action based on a config.</em>
<a id='L69' name='L69'></a>  69 <em class='comment'> * @return a pointer that must be deleted, or nullptr if the @a cfg could not be parsed.</em>
<a id='L70' name='L70'></a>  70 <em class='comment'> */</em>
<a id='L71' name='L71'></a>  71 <a href='../S/889.html#L38' title='Defined at 38 in src/actions/undo_action.hpp.'>undo_action_base</a> * <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/4427.html' title='Multiple referred from 2 places.'>create_action</a>(<strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>)
<a id='L72' name='L72'></a>  72 <em class='brace'>{</em>
<a id='L73' name='L73'></a>  73         <strong class='reserved'>const</strong> <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../D/14818.html' title='Multiple defined in 3 places.'>string</a> <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> = <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["type"];
<a id='L74' name='L74'></a>  74         <a href='../S/889.html#L38' title='Defined at 38 in src/actions/undo_action.hpp.'>undo_action_base</a> * <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> = <a href='../Y/15352.html' title='Multiple used in 1975 places.'>nullptr</a>;
<a id='L75' name='L75'></a>  75         <em class='comment'>// The general division of labor in this function is that the various</em>
<a id='L76' name='L76'></a>  76         <em class='comment'>// constructors will parse the "unit" child config, while this function</em>
<a id='L77' name='L77'></a>  77         <em class='comment'>// parses everything else.</em>
<a id='L78' name='L78'></a>  78 
<a id='L79' name='L79'></a>  79         <strong class='reserved'>if</strong> ( <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> == "move" ) <em class='brace'>{</em>
<a id='L80' name='L80'></a>  80                 <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> = <strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../D/11155.html' title='Multiple defined in 5 places.'>move_action</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>, <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../S/680.html#L385' title='Defined at 385 in src/config.cpp.'>child_or_empty</a>("unit"),
<a id='L81' name='L81'></a>  81                                        <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["starting_moves"],
<a id='L82' name='L82'></a>  82                                        <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>::<a href='../S/1094.html#L64' title='Defined at 64 in src/map/location.cpp.'>parse_direction</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["starting_direction"]));
<a id='L83' name='L83'></a>  83         <em class='brace'>}</em>
<a id='L84' name='L84'></a>  84 
<a id='L85' name='L85'></a>  85         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ( <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> == "recruit" ) <em class='brace'>{</em>
<a id='L86' name='L86'></a>  86                 <em class='comment'>// Validate the unit type.</em>
<a id='L87' name='L87'></a>  87                 <strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a> = <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>("unit");
<a id='L88' name='L88'></a>  88                 <strong class='reserved'>const</strong> <a href='../D/15656.html' title='Multiple defined in 3 places.'>unit_type</a> * <a href='../Y/20944.html' title='Multiple used in 59 places.'>u_type</a> = <a href='../Y/21158.html' title='Multiple used in 155 places.'>unit_types</a>.<a href='../D/6276.html' title='Multiple defined in 37 places.'>find</a>(<a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>["type"]);
<a id='L89' name='L89'></a>  89 
<a id='L90' name='L90'></a>  90                 <strong class='reserved'>if</strong> ( !<a href='../Y/20944.html' title='Multiple used in 59 places.'>u_type</a> ) <em class='brace'>{</em>
<a id='L91' name='L91'></a>  91                         <em class='comment'>// Bad data.</em>
<a id='L92' name='L92'></a>  92                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Invalid recruit found in [undo] or [redo]; unit type '"
<a id='L93' name='L93'></a>  93                                &lt;&lt; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>["type"] &lt;&lt; "' was not found.\n";
<a id='L94' name='L94'></a>  94                         <strong class='reserved'>return</strong> <a href='../Y/15352.html' title='Multiple used in 1975 places.'>nullptr</a>;
<a id='L95' name='L95'></a>  95                 <em class='brace'>}</em>
<a id='L96' name='L96'></a>  96                 <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> = <strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/886.html#L26' title='Defined at 26 in src/actions/undo_recruit_action.hpp.'>recruit_action</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>, *<a href='../Y/20944.html' title='Multiple used in 59 places.'>u_type</a>, <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../S/680.html#L385' title='Defined at 385 in src/config.cpp.'>child_or_empty</a>("leader"), <a href='../Y/15352.html' title='Multiple used in 1975 places.'>nullptr</a>));
<a id='L97' name='L97'></a>  97         <em class='brace'>}</em>
<a id='L98' name='L98'></a>  98 
<a id='L99' name='L99'></a>  99         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ( <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> == "recall" )
<a id='L100' name='L100'></a> 100                 <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> =  <strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/894.html#L27' title='Defined at 27 in src/actions/undo_recall_action.hpp.'>recall_action</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>, <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../S/680.html#L385' title='Defined at 385 in src/config.cpp.'>child_or_empty</a>("leader"), <a href='../Y/15352.html' title='Multiple used in 1975 places.'>nullptr</a>));
<a id='L101' name='L101'></a> 101 
<a id='L102' name='L102'></a> 102         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ( <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> == "dismiss" )
<a id='L103' name='L103'></a> 103                 <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> =  <strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/883.html#L25' title='Defined at 25 in src/actions/undo_dismiss_action.hpp.'>dismiss_action</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>, <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>("unit"));
<a id='L104' name='L104'></a> 104 
<a id='L105' name='L105'></a> 105         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ( <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> == "auto_shroud" )
<a id='L106' name='L106'></a> 106                 <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> =  <strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/893.html#L25' title='Defined at 25 in src/actions/undo_update_shroud_action.hpp.'>auto_shroud_action</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["active"].<a href='../D/15241.html' title='Multiple defined in 2 places.'>to_bool</a>());
<a id='L107' name='L107'></a> 107 
<a id='L108' name='L108'></a> 108         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ( <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> == "update_shroud" )
<a id='L109' name='L109'></a> 109                 <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a> =  <strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/893.html#L39' title='Defined at 39 in src/actions/undo_update_shroud_action.hpp.'>update_shroud_action</a>();
<a id='L110' name='L110'></a> 110         <strong class='reserved'>else</strong>
<a id='L111' name='L111'></a> 111         <em class='brace'>{</em>
<a id='L112' name='L112'></a> 112                 <em class='comment'>// Unrecognized type.</em>
<a id='L113' name='L113'></a> 113                 <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Unrecognized undo action type: " &lt;&lt; <a href='../D/14785.html' title='Multiple defined in 25 places.'>str</a> &lt;&lt; "." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L114' name='L114'></a> 114                 <strong class='reserved'>return</strong> <a href='../Y/15352.html' title='Multiple used in 1975 places.'>nullptr</a>;
<a id='L115' name='L115'></a> 115         <em class='brace'>}</em>
<a id='L116' name='L116'></a> 116         <strong class='reserved'>return</strong> <a href='../Y/17566.html' title='Multiple used in 1905 places.'>res</a>;
<a id='L117' name='L117'></a> 117 <em class='brace'>}</em>
<a id='L118' name='L118'></a> 118 
<a id='L119' name='L119'></a> 119 
<a id='L120' name='L120'></a> 120 <em class='comment'>/**</em>
<a id='L121' name='L121'></a> 121 <em class='comment'> * Constructor.</em>
<a id='L122' name='L122'></a> 122 <em class='comment'> * The config is allowed to be invalid.</em>
<a id='L123' name='L123'></a> 123 <em class='comment'> */</em>
<a id='L124' name='L124'></a> 124 <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>(<strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>) :
<a id='L125' name='L125'></a> 125         <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>(), <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>(), <a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a>(1), <a href='../R/4106.html' title='Multiple referred from 7 places.'>committed_actions_</a>(<strong class='reserved'>false</strong>)
<a id='L126' name='L126'></a> 126 <em class='brace'>{</em>
<a id='L127' name='L127'></a> 127         <strong class='reserved'>if</strong> ( <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a> )
<a id='L128' name='L128'></a> 128                 <a href='../D/12389.html' title='Multiple defined in 23 places.'>read</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>);
<a id='L129' name='L129'></a> 129 <em class='brace'>}</em>
<a id='L130' name='L130'></a> 130 
<a id='L131' name='L131'></a> 131 <em class='comment'>/**</em>
<a id='L132' name='L132'></a> 132 <em class='comment'> * Destructor.</em>
<a id='L133' name='L133'></a> 133 <em class='comment'> */</em>
<a id='L134' name='L134'></a> 134 <a href='../R/14263.html' title='Multiple referred from 41 places.'>undo_list</a>::~<a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>()
<a id='L135' name='L135'></a> 135 <em class='brace'>{</em>
<a id='L136' name='L136'></a> 136         <em class='comment'>// Default destructor, but defined out-of-line to localize the templating.</em>
<a id='L137' name='L137'></a> 137         <em class='comment'>// (Might make compiles faster.)</em>
<a id='L138' name='L138'></a> 138 <em class='brace'>}</em>
<a id='L139' name='L139'></a> 139 
<a id='L140' name='L140'></a> 140 
<a id='L141' name='L141'></a> 141 <em class='comment'>/**</em>
<a id='L142' name='L142'></a> 142 <em class='comment'> * Adds an auto-shroud toggle to the undo stack.</em>
<a id='L143' name='L143'></a> 143 <em class='comment'> */</em>
<a id='L144' name='L144'></a> 144 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2591.html' title='Multiple referred from 2 places.'>add_auto_shroud</a>(<strong class='reserved'>bool</strong> <a href='../Y/20790.html' title='Multiple used in 8 places.'>turned_on</a>)
<a id='L145' name='L145'></a> 145 <em class='brace'>{</em>
<a id='L146' name='L146'></a> 146         <em class='comment'>/// @todo: Consecutive shroud actions can be collapsed into one.</em>
<a id='L147' name='L147'></a> 147 
<a id='L148' name='L148'></a> 148         <em class='comment'>// Do not call add(), as this should not clear the redo stack.</em>
<a id='L149' name='L149'></a> 149         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/893.html#L25' title='Defined at 25 in src/actions/undo_update_shroud_action.hpp.'>auto_shroud_action</a>(<a href='../Y/20790.html' title='Multiple used in 8 places.'>turned_on</a>));
<a id='L150' name='L150'></a> 150 <em class='brace'>}</em>
<a id='L151' name='L151'></a> 151 
<a id='L152' name='L152'></a> 152 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2623.html' title='Multiple referred from 2 places.'>add_dummy</a>()
<a id='L153' name='L153'></a> 153 <em class='brace'>{</em>
<a id='L154' name='L154'></a> 154         <em class='comment'>/// @todo: Consecutive shroud actions can be collapsed into one.</em>
<a id='L155' name='L155'></a> 155 
<a id='L156' name='L156'></a> 156         <em class='comment'>// Do not call add(), as this should not clear the redo stack.</em>
<a id='L157' name='L157'></a> 157         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../S/889.html#L89' title='Defined at 89 in src/actions/undo_action.hpp.'>undo_dummy_action</a>());
<a id='L158' name='L158'></a> 158 <em class='brace'>}</em>
<a id='L159' name='L159'></a> 159 
<a id='L160' name='L160'></a> 160 <em class='comment'>/**</em>
<a id='L161' name='L161'></a> 161 <em class='comment'> * Adds a dismissal to the undo stack.</em>
<a id='L162' name='L162'></a> 162 <em class='comment'> */</em>
<a id='L163' name='L163'></a> 163 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2622.html' title='Multiple referred from 2 places.'>add_dismissal</a>(<strong class='reserved'>const</strong> <a href='../S/993.html#L30' title='Defined at 30 in src/units/ptr.hpp.'>unit_const_ptr</a> <a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>)
<a id='L164' name='L164'></a> 164 <em class='brace'>{</em>
<a id='L165' name='L165'></a> 165         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/883.html#L25' title='Defined at 25 in src/actions/undo_dismiss_action.hpp.'>dismiss_action</a>(<a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>));
<a id='L166' name='L166'></a> 166 <em class='brace'>}</em>
<a id='L167' name='L167'></a> 167 
<a id='L168' name='L168'></a> 168 <em class='comment'>/**</em>
<a id='L169' name='L169'></a> 169 <em class='comment'> * Adds a move to the undo stack.</em>
<a id='L170' name='L170'></a> 170 <em class='comment'> */</em>
<a id='L171' name='L171'></a> 171 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2677.html' title='Multiple referred from 2 places.'>add_move</a>(<strong class='reserved'>const</strong> <a href='../S/993.html#L30' title='Defined at 30 in src/units/ptr.hpp.'>unit_const_ptr</a> <a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>,
<a id='L172' name='L172'></a> 172                          <strong class='reserved'>const</strong> <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/21571.html' title='Multiple used in 2732 places.'>vector</a>&lt;<a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&gt;::<a href='../D/4855.html' title='Multiple defined in 13 places.'>const_iterator</a> &amp; <a href='../D/3617.html' title='Multiple defined in 28 places.'>begin</a>,
<a id='L173' name='L173'></a> 173                          <strong class='reserved'>const</strong> <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/21571.html' title='Multiple used in 2732 places.'>vector</a>&lt;<a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&gt;::<a href='../D/4855.html' title='Multiple defined in 13 places.'>const_iterator</a> &amp; <a href='../D/5896.html' title='Multiple defined in 28 places.'>end</a>,
<a id='L174' name='L174'></a> 174                          <strong class='reserved'>int</strong> <a href='../Y/19172.html' title='Multiple used in 3 places.'>start_moves</a>, <strong class='reserved'>int</strong> <a href='../Y/20286.html' title='Multiple used in 5 places.'>timebonus</a>, <strong class='reserved'>int</strong> <a href='../S/936.html#L109' title='Defined at 109 in src/display_context.cpp.'>village_owner</a>,
<a id='L175' name='L175'></a> 175                          <strong class='reserved'>const</strong> <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>::<a href='../D/346.html' title='Multiple defined in 2 places.'>DIRECTION</a> <a href='../Y/8834.html' title='Multiple used in 162 places.'>dir</a>)
<a id='L176' name='L176'></a> 176 <em class='brace'>{</em>
<a id='L177' name='L177'></a> 177         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../D/11155.html' title='Multiple defined in 5 places.'>move_action</a>(<a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>, <a href='../D/3617.html' title='Multiple defined in 28 places.'>begin</a>, <a href='../D/5896.html' title='Multiple defined in 28 places.'>end</a>, <a href='../Y/19172.html' title='Multiple used in 3 places.'>start_moves</a>, <a href='../Y/20286.html' title='Multiple used in 5 places.'>timebonus</a>, <a href='../S/936.html#L109' title='Defined at 109 in src/display_context.cpp.'>village_owner</a>, <a href='../Y/8834.html' title='Multiple used in 162 places.'>dir</a>));
<a id='L178' name='L178'></a> 178 <em class='brace'>}</em>
<a id='L179' name='L179'></a> 179 
<a id='L180' name='L180'></a> 180 <em class='comment'>/**</em>
<a id='L181' name='L181'></a> 181 <em class='comment'> * Adds a recall to the undo stack.</em>
<a id='L182' name='L182'></a> 182 <em class='comment'> */</em>
<a id='L183' name='L183'></a> 183 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2695.html' title='Multiple referred from 2 places.'>add_recall</a>(<strong class='reserved'>const</strong> <a href='../S/993.html#L30' title='Defined at 30 in src/units/ptr.hpp.'>unit_const_ptr</a> <a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>, <strong class='reserved'>const</strong> <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&amp; <a href='../D/9967.html' title='Multiple defined in 7 places.'>loc</a>,
<a id='L184' name='L184'></a> 184                            <strong class='reserved'>const</strong> <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&amp; <a href='../Y/10503.html' title='Multiple used in 190 places.'>from</a>, <strong class='reserved'>int</strong> <a href='../Y/15851.html' title='Multiple used in 14 places.'>orig_village_owner</a>, <strong class='reserved'>bool</strong> <a href='../Y/20264.html' title='Multiple used in 11 places.'>time_bonus</a>)
<a id='L185' name='L185'></a> 185 <em class='brace'>{</em>
<a id='L186' name='L186'></a> 186         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/894.html#L27' title='Defined at 27 in src/actions/undo_recall_action.hpp.'>recall_action</a>(<a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>, <a href='../D/9967.html' title='Multiple defined in 7 places.'>loc</a>, <a href='../Y/10503.html' title='Multiple used in 190 places.'>from</a>, <a href='../Y/15851.html' title='Multiple used in 14 places.'>orig_village_owner</a>, <a href='../Y/20264.html' title='Multiple used in 11 places.'>time_bonus</a>));
<a id='L187' name='L187'></a> 187 <em class='brace'>}</em>
<a id='L188' name='L188'></a> 188 
<a id='L189' name='L189'></a> 189 <em class='comment'>/**</em>
<a id='L190' name='L190'></a> 190 <em class='comment'> * Adds a recruit to the undo stack.</em>
<a id='L191' name='L191'></a> 191 <em class='comment'> */</em>
<a id='L192' name='L192'></a> 192 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2697.html' title='Multiple referred from 5 places.'>add_recruit</a>(<strong class='reserved'>const</strong> <a href='../S/993.html#L30' title='Defined at 30 in src/units/ptr.hpp.'>unit_const_ptr</a> <a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>, <strong class='reserved'>const</strong> <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&amp; <a href='../D/9967.html' title='Multiple defined in 7 places.'>loc</a>,
<a id='L193' name='L193'></a> 193                             <strong class='reserved'>const</strong> <a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&amp; <a href='../Y/10503.html' title='Multiple used in 190 places.'>from</a>, <strong class='reserved'>int</strong> <a href='../Y/15851.html' title='Multiple used in 14 places.'>orig_village_owner</a>, <strong class='reserved'>bool</strong> <a href='../Y/20264.html' title='Multiple used in 11 places.'>time_bonus</a>)
<a id='L194' name='L194'></a> 194 <em class='brace'>{</em>
<a id='L195' name='L195'></a> 195         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/886.html#L26' title='Defined at 26 in src/actions/undo_recruit_action.hpp.'>recruit_action</a>(<a href='../Y/20906.html' title='Multiple used in 1991 places.'>u</a>, <a href='../D/9967.html' title='Multiple defined in 7 places.'>loc</a>, <a href='../Y/10503.html' title='Multiple used in 190 places.'>from</a>, <a href='../Y/15851.html' title='Multiple used in 14 places.'>orig_village_owner</a>, <a href='../Y/20264.html' title='Multiple used in 11 places.'>time_bonus</a>));
<a id='L196' name='L196'></a> 196 <em class='brace'>}</em>
<a id='L197' name='L197'></a> 197 
<a id='L198' name='L198'></a> 198 <em class='comment'>/**</em>
<a id='L199' name='L199'></a> 199 <em class='comment'> * Adds a shroud update to the undo stack.</em>
<a id='L200' name='L200'></a> 200 <em class='comment'> * This is called from within commit_vision(), so there should be no need</em>
<a id='L201' name='L201'></a> 201 <em class='comment'> * for this to be publicly visible.</em>
<a id='L202' name='L202'></a> 202 <em class='comment'> */</em>
<a id='L203' name='L203'></a> 203 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/2757.html' title='Multiple referred from 2 places.'>add_update_shroud</a>()
<a id='L204' name='L204'></a> 204 <em class='brace'>{</em>
<a id='L205' name='L205'></a> 205         <em class='comment'>/// @todo: Consecutive shroud actions can be collapsed into one.</em>
<a id='L206' name='L206'></a> 206 
<a id='L207' name='L207'></a> 207         <a href='../D/2802.html' title='Multiple defined in 10 places.'>add</a>(<strong class='reserved'>new</strong> <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>::<a href='../S/893.html#L39' title='Defined at 39 in src/actions/undo_update_shroud_action.hpp.'>update_shroud_action</a>());
<a id='L208' name='L208'></a> 208 <em class='brace'>}</em>
<a id='L209' name='L209'></a> 209 
<a id='L210' name='L210'></a> 210 
<a id='L211' name='L211'></a> 211 <em class='comment'>/**</em>
<a id='L212' name='L212'></a> 212 <em class='comment'> * Clears the stack of undoable (and redoable) actions.</em>
<a id='L213' name='L213'></a> 213 <em class='comment'> * (Also handles updating fog/shroud if needed.)</em>
<a id='L214' name='L214'></a> 214 <em class='comment'> * Call this if an action alters the game state, but add that action to the</em>
<a id='L215' name='L215'></a> 215 <em class='comment'> * stack before calling this (if the action is a kind that can be undone).</em>
<a id='L216' name='L216'></a> 216 <em class='comment'> * This may fire events and change the game state.</em>
<a id='L217' name='L217'></a> 217 <em class='comment'> */</em>
<a id='L218' name='L218'></a> 218 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/3927.html' title='Multiple referred from 662 places.'>clear</a>()
<a id='L219' name='L219'></a> 219 <em class='brace'>{</em>
<a id='L220' name='L220'></a> 220         <em class='comment'>// The fact that this function was called indicates that something was done.</em>
<a id='L221' name='L221'></a> 221         <em class='comment'>// (Some actions, such as attacks, are never put on the stack.)</em>
<a id='L222' name='L222'></a> 222         <a href='../S/903.html#L125' title='Defined at 125 in src/actions/undo.cpp.'>committed_actions_</a> = <strong class='reserved'>true</strong>;
<a id='L223' name='L223'></a> 223 
<a id='L224' name='L224'></a> 224         <em class='comment'>// We can save some overhead by not calling apply_shroud_changes() for an</em>
<a id='L225' name='L225'></a> 225         <em class='comment'>// empty stack.</em>
<a id='L226' name='L226'></a> 226         <strong class='reserved'>if</strong> ( !<a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/5862.html' title='Multiple defined in 30 places.'>empty</a>() ) <em class='brace'>{</em>
<a id='L227' name='L227'></a> 227                 <a href='../S/903.html#L440' title='Defined at 440 in src/actions/undo.cpp.'>apply_shroud_changes</a>();
<a id='L228' name='L228'></a> 228                 <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/4475.html' title='Multiple defined in 39 places.'>clear</a>();
<a id='L229' name='L229'></a> 229         <em class='brace'>}</em>
<a id='L230' name='L230'></a> 230         <em class='comment'>// No special handling for redos, so just clear that stack.</em>
<a id='L231' name='L231'></a> 231         <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/4475.html' title='Multiple defined in 39 places.'>clear</a>();
<a id='L232' name='L232'></a> 232 <em class='brace'>}</em>
<a id='L233' name='L233'></a> 233 
<a id='L234' name='L234'></a> 234 
<a id='L235' name='L235'></a> 235 <em class='comment'>/**</em>
<a id='L236' name='L236'></a> 236 <em class='comment'> * Updates fog/shroud based on the undo stack, then updates stack as needed.</em>
<a id='L237' name='L237'></a> 237 <em class='comment'> * Call this when "updating shroud now".</em>
<a id='L238' name='L238'></a> 238 <em class='comment'> * This may fire events and change the game state.</em>
<a id='L239' name='L239'></a> 239 <em class='comment'> * @param[in]  is_replay  Set to true when this is called during a replay.</em>
<a id='L240' name='L240'></a> 240 <em class='comment'> */</em>
<a id='L241' name='L241'></a> 241 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/4105.html' title='Multiple referred from 2 places.'>commit_vision</a>()
<a id='L242' name='L242'></a> 242 <em class='brace'>{</em>
<a id='L243' name='L243'></a> 243         <em class='comment'>// Update fog/shroud.</em>
<a id='L244' name='L244'></a> 244         <strong class='reserved'>bool</strong> <a href='../Y/7491.html' title='Multiple used in 10 places.'>cleared_something</a> = <a href='../S/903.html#L440' title='Defined at 440 in src/actions/undo.cpp.'>apply_shroud_changes</a>();
<a id='L245' name='L245'></a> 245 
<a id='L246' name='L246'></a> 246         <strong class='reserved'>if</strong> (<a href='../Y/7491.html' title='Multiple used in 10 places.'>cleared_something</a>) <em class='brace'>{</em>
<a id='L247' name='L247'></a> 247                 <em class='comment'>// The actions that led to information being revealed can no longer</em>
<a id='L248' name='L248'></a> 248                 <em class='comment'>// be undone.</em>
<a id='L249' name='L249'></a> 249                 <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/4475.html' title='Multiple defined in 39 places.'>clear</a>();
<a id='L250' name='L250'></a> 250                 <em class='comment'>//undos_.erase(undos_.begin(), undos_.begin() + erase_to);</em>
<a id='L251' name='L251'></a> 251                 <a href='../S/903.html#L125' title='Defined at 125 in src/actions/undo.cpp.'>committed_actions_</a> = <strong class='reserved'>true</strong>;
<a id='L252' name='L252'></a> 252         <em class='brace'>}</em>
<a id='L253' name='L253'></a> 253 <em class='brace'>}</em>
<a id='L254' name='L254'></a> 254 
<a id='L255' name='L255'></a> 255 
<a id='L256' name='L256'></a> 256 <em class='comment'>/**</em>
<a id='L257' name='L257'></a> 257 <em class='comment'> * Performs some initializations and error checks when starting a new side-turn.</em>
<a id='L258' name='L258'></a> 258 <em class='comment'> * @param[in]  side  The side whose turn is about to start.</em>
<a id='L259' name='L259'></a> 259 <em class='comment'> */</em>
<a id='L260' name='L260'></a> 260 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/10314.html' title='Multiple referred from 3 places.'>new_side_turn</a>(<strong class='reserved'>int</strong> <a href='../D/14454.html' title='Multiple defined in 3 places.'>side</a>)
<a id='L261' name='L261'></a> 261 <em class='brace'>{</em>
<a id='L262' name='L262'></a> 262         <em class='comment'>// Error checks.</em>
<a id='L263' name='L263'></a> 263         <strong class='reserved'>if</strong> ( !<a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/5862.html' title='Multiple defined in 30 places.'>empty</a>() ) <em class='brace'>{</em>
<a id='L264' name='L264'></a> 264                 <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Undo stack not empty in new_side_turn()." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L265' name='L265'></a> 265                 <em class='comment'>// At worst, someone missed some sighted events, so try to recover.</em>
<a id='L266' name='L266'></a> 266                 <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/4475.html' title='Multiple defined in 39 places.'>clear</a>();
<a id='L267' name='L267'></a> 267                 <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/4475.html' title='Multiple defined in 39 places.'>clear</a>();
<a id='L268' name='L268'></a> 268         <em class='brace'>}</em>
<a id='L269' name='L269'></a> 269         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ( !<a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/5862.html' title='Multiple defined in 30 places.'>empty</a>() ) <em class='brace'>{</em>
<a id='L270' name='L270'></a> 270                 <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Redo stack not empty in new_side_turn()." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L271' name='L271'></a> 271                 <em class='comment'>// Sloppy tracking somewhere, but not critically so.</em>
<a id='L272' name='L272'></a> 272                 <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/4475.html' title='Multiple defined in 39 places.'>clear</a>();
<a id='L273' name='L273'></a> 273         <em class='brace'>}</em>
<a id='L274' name='L274'></a> 274 
<a id='L275' name='L275'></a> 275         <em class='comment'>// Reset the side.</em>
<a id='L276' name='L276'></a> 276         <a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a> = <a href='../D/14454.html' title='Multiple defined in 3 places.'>side</a>;
<a id='L277' name='L277'></a> 277         <a href='../S/903.html#L125' title='Defined at 125 in src/actions/undo.cpp.'>committed_actions_</a> = <strong class='reserved'>false</strong>;
<a id='L278' name='L278'></a> 278 <em class='brace'>}</em>
<a id='L279' name='L279'></a> 279 
<a id='L280' name='L280'></a> 280 
<a id='L281' name='L281'></a> 281 <em class='comment'>/**</em>
<a id='L282' name='L282'></a> 282 <em class='comment'> * Read the undo_list from the provided config.</em>
<a id='L283' name='L283'></a> 283 <em class='comment'> * Currently, this is only used when the undo_list is empty, but in theory</em>
<a id='L284' name='L284'></a> 284 <em class='comment'> * it could be used to append the config to the current data.</em>
<a id='L285' name='L285'></a> 285 <em class='comment'> */</em>
<a id='L286' name='L286'></a> 286 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/11292.html' title='Multiple referred from 127 places.'>read</a>(<strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>)
<a id='L287' name='L287'></a> 287 <em class='brace'>{</em>
<a id='L288' name='L288'></a> 288         <em class='comment'>// Merge header data.</em>
<a id='L289' name='L289'></a> 289         <a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a> = <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["side"].<a href='../D/15251.html' title='Multiple defined in 2 places.'>to_int</a>(<a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a>);
<a id='L290' name='L290'></a> 290         <a href='../S/903.html#L125' title='Defined at 125 in src/actions/undo.cpp.'>committed_actions_</a> = <a href='../S/903.html#L125' title='Defined at 125 in src/actions/undo.cpp.'>committed_actions_</a> || <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["committed"].<a href='../D/15241.html' title='Multiple defined in 2 places.'>to_bool</a>();
<a id='L291' name='L291'></a> 291 
<a id='L292' name='L292'></a> 292         <em class='comment'>// Build the undo stack.</em>
<a id='L293' name='L293'></a> 293         <strong class='reserved'>for</strong> (<strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a> : <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../D/4429.html' title='Multiple defined in 2 places.'>child_range</a>("undo")) <em class='brace'>{</em>
<a id='L294' name='L294'></a> 294                 <strong class='reserved'>try</strong> <em class='brace'>{</em>
<a id='L295' name='L295'></a> 295                         <a href='../S/889.html#L38' title='Defined at 38 in src/actions/undo_action.hpp.'>undo_action_base</a> * <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a> = <a href='../S/903.html#L71' title='Defined at 71 in src/actions/undo.cpp.'>create_action</a>(<a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>);
<a id='L296' name='L296'></a> 296                         <strong class='reserved'>if</strong> ( <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a> ) <em class='brace'>{</em>
<a id='L297' name='L297'></a> 297                                 <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/12249.html' title='Multiple defined in 3 places.'>push_back</a>(<a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>);
<a id='L298' name='L298'></a> 298                         <em class='brace'>}</em>
<a id='L299' name='L299'></a> 299                 <em class='brace'>}</em> <strong class='reserved'>catch</strong> (<a href='../S/684.html#L117' title='Defined at 117 in src/lexical_cast.hpp.'>bad_lexical_cast</a> &amp;) <em class='brace'>{</em>
<a id='L300' name='L300'></a> 300                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Error when parsing undo list from config: bad lexical cast." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L301' name='L301'></a> 301                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "config was: " &lt;&lt; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>.<a href='../D/5264.html' title='Multiple defined in 16 places.'>debug</a>() &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L302' name='L302'></a> 302                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Skipping this undo action..." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L303' name='L303'></a> 303                 <em class='brace'>}</em> <strong class='reserved'>catch</strong> (<a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>::<a href='../D/5977.html' title='Multiple defined in 22 places.'>error</a>&amp; <a href='../D/5772.html' title='Multiple defined in 3 places.'>e</a>) <em class='brace'>{</em>
<a id='L304' name='L304'></a> 304                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Error when parsing undo list from config: " &lt;&lt; <a href='../D/5772.html' title='Multiple defined in 3 places.'>e</a>.<a href='../D/16328.html' title='Multiple defined in 8 places.'>what</a>() &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L305' name='L305'></a> 305                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "config was: " &lt;&lt; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>.<a href='../D/5264.html' title='Multiple defined in 16 places.'>debug</a>() &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L306' name='L306'></a> 306                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Skipping this undo action..." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L307' name='L307'></a> 307                 <em class='brace'>}</em>
<a id='L308' name='L308'></a> 308         <em class='brace'>}</em>
<a id='L309' name='L309'></a> 309 
<a id='L310' name='L310'></a> 310         <em class='comment'>// Build the redo stack.</em>
<a id='L311' name='L311'></a> 311         <strong class='reserved'>for</strong> (<strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a> : <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../D/4429.html' title='Multiple defined in 2 places.'>child_range</a>("redo")) <em class='brace'>{</em>
<a id='L312' name='L312'></a> 312                 <strong class='reserved'>try</strong> <em class='brace'>{</em>
<a id='L313' name='L313'></a> 313                         <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/12249.html' title='Multiple defined in 3 places.'>push_back</a>(<strong class='reserved'>new</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>(<a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>));
<a id='L314' name='L314'></a> 314                 <em class='brace'>}</em> <strong class='reserved'>catch</strong> (<a href='../S/684.html#L117' title='Defined at 117 in src/lexical_cast.hpp.'>bad_lexical_cast</a> &amp;) <em class='brace'>{</em>
<a id='L315' name='L315'></a> 315                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Error when parsing redo list from config: bad lexical cast." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L316' name='L316'></a> 316                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "config was: " &lt;&lt; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>.<a href='../D/5264.html' title='Multiple defined in 16 places.'>debug</a>() &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L317' name='L317'></a> 317                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Skipping this redo action..." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L318' name='L318'></a> 318                 <em class='brace'>}</em> <strong class='reserved'>catch</strong> (<a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>::<a href='../D/5977.html' title='Multiple defined in 22 places.'>error</a>&amp; <a href='../D/5772.html' title='Multiple defined in 3 places.'>e</a>) <em class='brace'>{</em>
<a id='L319' name='L319'></a> 319                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Error when parsing redo list from config: " &lt;&lt; <a href='../D/5772.html' title='Multiple defined in 3 places.'>e</a>.<a href='../D/16328.html' title='Multiple defined in 8 places.'>what</a>() &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L320' name='L320'></a> 320                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "config was: " &lt;&lt; <a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>.<a href='../D/5264.html' title='Multiple defined in 16 places.'>debug</a>() &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L321' name='L321'></a> 321                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Skipping this redo action..." &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L322' name='L322'></a> 322                 <em class='brace'>}</em>
<a id='L323' name='L323'></a> 323         <em class='brace'>}</em>
<a id='L324' name='L324'></a> 324 <em class='brace'>}</em>
<a id='L325' name='L325'></a> 325 
<a id='L326' name='L326'></a> 326 
<a id='L327' name='L327'></a> 327 <em class='comment'>/**</em>
<a id='L328' name='L328'></a> 328 <em class='comment'> * Write the undo_list into the provided config.</em>
<a id='L329' name='L329'></a> 329 <em class='comment'> */</em>
<a id='L330' name='L330'></a> 330 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/15051.html' title='Multiple referred from 493 places.'>write</a>(<a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> &amp; <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>) <strong class='reserved'>const</strong>
<a id='L331' name='L331'></a> 331 <em class='brace'>{</em>
<a id='L332' name='L332'></a> 332         <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["side"] = <a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a>;
<a id='L333' name='L333'></a> 333         <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>["committed"] = <a href='../S/903.html#L125' title='Defined at 125 in src/actions/undo.cpp.'>committed_actions_</a>;
<a id='L334' name='L334'></a> 334 
<a id='L335' name='L335'></a> 335         <strong class='reserved'>for</strong> ( <a href='../S/910.html#L37' title='Defined at 37 in src/actions/undo.hpp.'>action_list</a>::<a href='../D/4855.html' title='Multiple defined in 13 places.'>const_iterator</a> <a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a> = <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/3617.html' title='Multiple defined in 28 places.'>begin</a>(); <a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a> != <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/5896.html' title='Multiple defined in 28 places.'>end</a>(); ++<a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a> )
<a id='L336' name='L336'></a> 336                 <a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a>-&gt;<a href='../D/16544.html' title='Multiple defined in 55 places.'>write</a>(<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../D/2856.html' title='Multiple defined in 8 places.'>add_child</a>("undo"));
<a id='L337' name='L337'></a> 337 
<a id='L338' name='L338'></a> 338         <strong class='reserved'>for</strong> ( <a href='../S/910.html#L38' title='Defined at 38 in src/actions/undo.hpp.'>redos_list</a>::<a href='../D/4855.html' title='Multiple defined in 13 places.'>const_iterator</a> <a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a> = <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/3617.html' title='Multiple defined in 28 places.'>begin</a>(); <a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a> != <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/5896.html' title='Multiple defined in 28 places.'>end</a>(); ++<a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a> )
<a id='L339' name='L339'></a> 339                 <a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>.<a href='../D/2856.html' title='Multiple defined in 8 places.'>add_child</a>("redo") = *<a href='../Y/12511.html' title='Multiple used in 755 places.'>it</a>;
<a id='L340' name='L340'></a> 340 <em class='brace'>}</em>
<a id='L341' name='L341'></a> 341 
<a id='L342' name='L342'></a> 342 
<a id='L343' name='L343'></a> 343 <em class='comment'>/**</em>
<a id='L344' name='L344'></a> 344 <em class='comment'> * Undoes the top action on the undo stack.</em>
<a id='L345' name='L345'></a> 345 <em class='comment'> */</em>
<a id='L346' name='L346'></a> 346 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/14255.html' title='Multiple referred from 86 places.'>undo</a>()
<a id='L347' name='L347'></a> 347 <em class='brace'>{</em>
<a id='L348' name='L348'></a> 348         <strong class='reserved'>if</strong> ( <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/5862.html' title='Multiple defined in 30 places.'>empty</a>() )
<a id='L349' name='L349'></a> 349                 <strong class='reserved'>return</strong>;
<a id='L350' name='L350'></a> 350 
<a id='L351' name='L351'></a> 351         <strong class='reserved'>const</strong> <a href='../D/6013.html' title='Multiple defined in 26 places.'>events</a>::<a href='../D/4645.html' title='Multiple defined in 3 places.'>command_disabler</a> <a href='../Y/8882.html' title='Multiple used in 10 places.'>disable_commands</a>;
<a id='L352' name='L352'></a> 352 
<a id='L353' name='L353'></a> 353         <a href='../D/6620.html' title='Multiple defined in 2 places.'>game_display</a> &amp; <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a> = *<a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../S/1164.html#L55' title='Defined at 55 in src/reports.hpp.'>screen</a>;
<a id='L354' name='L354'></a> 354 
<a id='L355' name='L355'></a> 355         <em class='comment'>// Get the action to undo. (This will be placed on the redo stack, but</em>
<a id='L356' name='L356'></a> 356         <em class='comment'>// only if the undo is successful.)</em>
<a id='L357' name='L357'></a> 357         <a href='../S/910.html#L37' title='Defined at 37 in src/actions/undo.hpp.'>action_list</a>::<a href='../Y/6114.html' title='Multiple used in 2 places.'>auto_type</a> <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a> = <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../S/863.html#L266' title='Defined at 266 in src/utils/smart_list.hpp.'>pop_back</a>();
<a id='L358' name='L358'></a> 358         <strong class='reserved'>if</strong> (<a href='../S/889.html#L60' title='Defined at 60 in src/actions/undo_action.hpp.'>undo_action</a>* <a href='../Y/21026.html' title='Multiple used in 4 places.'>undoable_action</a> = <strong class='reserved'>dynamic_cast</strong>&lt;<a href='../S/889.html#L60' title='Defined at 60 in src/actions/undo_action.hpp.'>undo_action</a>*&gt;(<a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>.<a href='../D/12226.html' title='Multiple defined in 3 places.'>ptr</a>()))
<a id='L359' name='L359'></a> 359         <em class='brace'>{</em>
<a id='L360' name='L360'></a> 360                 <strong class='reserved'>int</strong> <a href='../Y/12939.html' title='Multiple used in 3 places.'>last_unit_id</a> = <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/10637.html' title='Multiple used in 670 places.'>gameboard</a>-&gt;<a href='../S/140.html#L86' title='Defined at 86 in src/game_board.hpp.'>unit_id_manager</a>().<a href='../D/7928.html' title='Multiple defined in 2 places.'>get_save_id</a>();
<a id='L361' name='L361'></a> 361                 <strong class='reserved'>if</strong> ( !<a href='../Y/21026.html' title='Multiple used in 4 places.'>undoable_action</a>-&gt;<a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>(<a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a>) ) <em class='brace'>{</em>
<a id='L362' name='L362'></a> 362                         <strong class='reserved'>return</strong>;
<a id='L363' name='L363'></a> 363                 <em class='brace'>}</em>
<a id='L364' name='L364'></a> 364                 <strong class='reserved'>if</strong>(<a href='../Y/12939.html' title='Multiple used in 3 places.'>last_unit_id</a> - <a href='../Y/21026.html' title='Multiple used in 4 places.'>undoable_action</a>-&gt;<a href='../D/15610.html' title='Multiple defined in 2 places.'>unit_id_diff</a> &lt; 0) <em class='brace'>{</em>
<a id='L365' name='L365'></a> 365                         <a href='../D/481.html' title='Multiple defined in 42 places.'>ERR_NG</a> &lt;&lt; "Next unit id is below 0 after undoing" &lt;&lt; <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/9398.html' title='Multiple used in 927 places.'>endl</a>;
<a id='L366' name='L366'></a> 366                 <em class='brace'>}</em>
<a id='L367' name='L367'></a> 367                 <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/10637.html' title='Multiple used in 670 places.'>gameboard</a>-&gt;<a href='../S/140.html#L86' title='Defined at 86 in src/game_board.hpp.'>unit_id_manager</a>().<a href='../D/14055.html' title='Multiple defined in 2 places.'>set_save_id</a>(<a href='../Y/12939.html' title='Multiple used in 3 places.'>last_unit_id</a> - <a href='../Y/21026.html' title='Multiple used in 4 places.'>undoable_action</a>-&gt;<a href='../D/15610.html' title='Multiple defined in 2 places.'>unit_id_diff</a>);
<a id='L368' name='L368'></a> 368 
<a id='L369' name='L369'></a> 369                 <em class='comment'>// Bookkeeping.</em>
<a id='L370' name='L370'></a> 370                 <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/12249.html' title='Multiple defined in 3 places.'>push_back</a>(<strong class='reserved'>new</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>());
<a id='L371' name='L371'></a> 371                 <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/17199.html' title='Multiple used in 64 places.'>recorder</a>-&gt;<a href='../S/1105.html#L486' title='Defined at 486 in src/replay.cpp.'>undo_cut</a>(<a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/3546.html' title='Multiple defined in 5 places.'>back</a>());
<a id='L372' name='L372'></a> 372 
<a id='L373' name='L373'></a> 373                 <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/21937.html' title='Multiple used in 64 places.'>whiteboard</a>-&gt;<a href='../S/1239.html#L588' title='Defined at 588 in src/whiteboard/manager.cpp.'>on_gamestate_change</a>();
<a id='L374' name='L374'></a> 374 
<a id='L375' name='L375'></a> 375                 <em class='comment'>// Screen updates.</em>
<a id='L376' name='L376'></a> 376                 <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../S/745.html#L124' title='Defined at 124 in src/game_display.hpp.'>invalidate_unit</a>();
<a id='L377' name='L377'></a> 377                 <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../S/964.html#L291' title='Defined at 291 in src/display.hpp.'>invalidate_game_status</a>();
<a id='L378' name='L378'></a> 378                 <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../S/964.html#L599' title='Defined at 599 in src/display.hpp.'>redraw_minimap</a>();
<a id='L379' name='L379'></a> 379                 <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../D/5690.html' title='Multiple defined in 26 places.'>draw</a>();
<a id='L380' name='L380'></a> 380         <em class='brace'>}</em>
<a id='L381' name='L381'></a> 381         <strong class='reserved'>else</strong>
<a id='L382' name='L382'></a> 382         <em class='brace'>{</em>
<a id='L383' name='L383'></a> 383                 <em class='comment'>//ignore this action, and undo the previous one.</em>
<a id='L384' name='L384'></a> 384                 <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a> <a href='../Y/17493.html' title='Multiple used in 6 places.'>replay_data</a>;
<a id='L385' name='L385'></a> 385                 <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/17199.html' title='Multiple used in 64 places.'>recorder</a>-&gt;<a href='../S/1105.html#L486' title='Defined at 486 in src/replay.cpp.'>undo_cut</a>(<a href='../Y/17493.html' title='Multiple used in 6 places.'>replay_data</a>);
<a id='L386' name='L386'></a> 386                 <a href='../D/15525.html' title='Multiple defined in 22 places.'>undo</a>();
<a id='L387' name='L387'></a> 387                 <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/17199.html' title='Multiple used in 64 places.'>recorder</a>-&gt;<a href='../D/12560.html' title='Multiple defined in 7 places.'>redo</a>(<a href='../Y/17493.html' title='Multiple used in 6 places.'>replay_data</a>);
<a id='L388' name='L388'></a> 388                 <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/12249.html' title='Multiple defined in 3 places.'>push_back</a>(<a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>.<a href='../D/12646.html' title='Multiple defined in 2 places.'>release</a>());
<a id='L389' name='L389'></a> 389         <em class='brace'>}</em>
<a id='L390' name='L390'></a> 390 <em class='brace'>}</em>
<a id='L391' name='L391'></a> 391 
<a id='L392' name='L392'></a> 392 
<a id='L393' name='L393'></a> 393 
<a id='L394' name='L394'></a> 394 <em class='comment'>/**</em>
<a id='L395' name='L395'></a> 395 <em class='comment'> * Redoes the top action on the redo stack.</em>
<a id='L396' name='L396'></a> 396 <em class='comment'> */</em>
<a id='L397' name='L397'></a> 397 <strong class='reserved'>void</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/11458.html' title='Multiple referred from 12 places.'>redo</a>()
<a id='L398' name='L398'></a> 398 <em class='brace'>{</em>
<a id='L399' name='L399'></a> 399         <strong class='reserved'>if</strong> ( <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../D/5862.html' title='Multiple defined in 30 places.'>empty</a>() )
<a id='L400' name='L400'></a> 400                 <strong class='reserved'>return</strong>;
<a id='L401' name='L401'></a> 401 
<a id='L402' name='L402'></a> 402         <strong class='reserved'>const</strong> <a href='../D/6013.html' title='Multiple defined in 26 places.'>events</a>::<a href='../D/4645.html' title='Multiple defined in 3 places.'>command_disabler</a> <a href='../Y/8882.html' title='Multiple used in 10 places.'>disable_commands</a>;
<a id='L403' name='L403'></a> 403 
<a id='L404' name='L404'></a> 404         <a href='../D/6620.html' title='Multiple defined in 2 places.'>game_display</a> &amp; <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a> = *<a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../S/1164.html#L55' title='Defined at 55 in src/reports.hpp.'>screen</a>;
<a id='L405' name='L405'></a> 405 
<a id='L406' name='L406'></a> 406         <em class='comment'>// Get the action to redo. (This will be placed on the undo stack, but</em>
<a id='L407' name='L407'></a> 407         <em class='comment'>// only if the redo is successful.)</em>
<a id='L408' name='L408'></a> 408         <a href='../S/910.html#L38' title='Defined at 38 in src/actions/undo.hpp.'>redos_list</a>::<a href='../Y/6114.html' title='Multiple used in 2 places.'>auto_type</a> <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a> = <a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>.<a href='../S/863.html#L266' title='Defined at 266 in src/utils/smart_list.hpp.'>pop_back</a>();
<a id='L409' name='L409'></a> 409 
<a id='L410' name='L410'></a> 410         <strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>&amp; <a href='../Y/7719.html' title='Multiple used in 3 places.'>command_wml</a> = <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>-&gt;<a href='../D/4415.html' title='Multiple defined in 14 places.'>child</a>("command");
<a id='L411' name='L411'></a> 411         <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../D/14818.html' title='Multiple defined in 3 places.'>string</a> <a href='../Y/7723.html' title='Multiple used in 23 places.'>commandname</a> = <a href='../Y/7719.html' title='Multiple used in 3 places.'>command_wml</a>.<a href='../D/3240.html' title='Multiple defined in 2 places.'>all_children_range</a>().<a href='../D/6556.html' title='Multiple defined in 5 places.'>front</a>().<a href='../D/9611.html' title='Multiple defined in 4 places.'>key</a>;
<a id='L412' name='L412'></a> 412         <strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>&amp; <a href='../D/5234.html' title='Multiple defined in 16 places.'>data</a> = <a href='../Y/7719.html' title='Multiple used in 3 places.'>command_wml</a>.<a href='../D/3240.html' title='Multiple defined in 2 places.'>all_children_range</a>().<a href='../D/6556.html' title='Multiple defined in 5 places.'>front</a>().<a href='../D/4194.html' title='Multiple defined in 5 places.'>cfg</a>;
<a id='L413' name='L413'></a> 413 
<a id='L414' name='L414'></a> 414         <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/17199.html' title='Multiple used in 64 places.'>recorder</a>-&gt;<a href='../D/12560.html' title='Multiple defined in 7 places.'>redo</a>(<strong class='reserved'>const_cast</strong>&lt;<strong class='reserved'>const</strong> <a href='../D/4767.html' title='Multiple defined in 5 places.'>config</a>&amp;&gt;(*<a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>));
<a id='L415' name='L415'></a> 415 
<a id='L416' name='L416'></a> 416 
<a id='L417' name='L417'></a> 417         <em class='comment'>// synced_context::run readds the undo command with the normal undo_lis::add function whihc clears the</em>
<a id='L418' name='L418'></a> 418         <em class='comment'>// redo stack which makes redoign of more than one move impossible. to work around that we save redo stack here and set it later.</em>
<a id='L419' name='L419'></a> 419         <a href='../S/910.html#L38' title='Defined at 38 in src/actions/undo.hpp.'>redos_list</a> <a href='../Y/19815.html' title='Multiple used in 215 places.'>temp</a>;
<a id='L420' name='L420'></a> 420         <a href='../Y/19815.html' title='Multiple used in 215 places.'>temp</a>.<a href='../D/14904.html' title='Multiple defined in 22 places.'>swap</a>(<a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>);
<a id='L421' name='L421'></a> 421         <a href='../S/747.html#L31' title='Defined at 31 in src/synced_context.hpp.'>synced_context</a>::<a href='../D/13176.html' title='Multiple defined in 57 places.'>run</a>(<a href='../Y/7723.html' title='Multiple used in 23 places.'>commandname</a>, <a href='../D/5234.html' title='Multiple defined in 16 places.'>data</a>, <em class='comment'>/*use_undo*/</em> <strong class='reserved'>true</strong>, <em class='comment'>/*show*/</em> <strong class='reserved'>true</strong>);
<a id='L422' name='L422'></a> 422         <a href='../Y/19815.html' title='Multiple used in 215 places.'>temp</a>.<a href='../D/14904.html' title='Multiple defined in 22 places.'>swap</a>(<a href='../Y/17300.html' title='Multiple used in 16 places.'>redos_</a>);
<a id='L423' name='L423'></a> 423 
<a id='L424' name='L424'></a> 424         <em class='comment'>// Screen updates.</em>
<a id='L425' name='L425'></a> 425         <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../S/745.html#L124' title='Defined at 124 in src/game_display.hpp.'>invalidate_unit</a>();
<a id='L426' name='L426'></a> 426         <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../S/964.html#L291' title='Defined at 291 in src/display.hpp.'>invalidate_game_status</a>();
<a id='L427' name='L427'></a> 427         <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../S/964.html#L599' title='Defined at 599 in src/display.hpp.'>redraw_minimap</a>();
<a id='L428' name='L428'></a> 428         <a href='../D/8301.html' title='Multiple defined in 28 places.'>gui</a>.<a href='../D/5690.html' title='Multiple defined in 26 places.'>draw</a>();
<a id='L429' name='L429'></a> 429 <em class='brace'>}</em>
<a id='L430' name='L430'></a> 430 
<a id='L431' name='L431'></a> 431 
<a id='L432' name='L432'></a> 432 
<a id='L433' name='L433'></a> 433 
<a id='L434' name='L434'></a> 434 
<a id='L435' name='L435'></a> 435 <em class='comment'>/**</em>
<a id='L436' name='L436'></a> 436 <em class='comment'> * Applies the pending fog/shroud changes from the undo stack.</em>
<a id='L437' name='L437'></a> 437 <em class='comment'> * Does nothing if the the current side does not use fog or shroud.</em>
<a id='L438' name='L438'></a> 438 <em class='comment'> * @returns  true if shroud  or fog was cleared.</em>
<a id='L439' name='L439'></a> 439 <em class='comment'> */</em>
<a id='L440' name='L440'></a> 440 <strong class='reserved'>bool</strong> <a href='../D/15533.html' title='Multiple defined in 2 places.'>undo_list</a>::<a href='../R/3005.html' title='Multiple referred from 3 places.'>apply_shroud_changes</a>() <strong class='reserved'>const</strong>
<a id='L441' name='L441'></a> 441 <em class='brace'>{</em>
<a id='L442' name='L442'></a> 442         <a href='../D/6620.html' title='Multiple defined in 2 places.'>game_display</a> &amp;<a href='../S/1103.html#L157' title='Defined at 157 in src/halo.cpp.'>disp</a> = *<a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../S/1164.html#L55' title='Defined at 55 in src/reports.hpp.'>screen</a>;
<a id='L443' name='L443'></a> 443         <a href='../D/14993.html' title='Multiple defined in 3 places.'>team</a> &amp;<a href='../Y/20347.html' title='Multiple used in 149 places.'>tm</a> = <a href='../D/12927.html' title='Multiple defined in 2 places.'>resources</a>::<a href='../Y/10637.html' title='Multiple used in 670 places.'>gameboard</a>-&gt;<a href='../D/8042.html' title='Multiple defined in 3 places.'>get_team</a>(<a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a>);
<a id='L444' name='L444'></a> 444         <em class='comment'>// No need to do clearing if fog/shroud has been kept up-to-date.</em>
<a id='L445' name='L445'></a> 445         <strong class='reserved'>if</strong> ( <a href='../Y/20347.html' title='Multiple used in 149 places.'>tm</a>.<a href='../S/1080.html#L332' title='Defined at 332 in src/team.hpp.'>auto_shroud_updates</a>()  ||  !<a href='../Y/20347.html' title='Multiple used in 149 places.'>tm</a>.<a href='../S/1080.html#L314' title='Defined at 314 in src/team.hpp.'>fog_or_shroud</a>() ) <em class='brace'>{</em>
<a id='L446' name='L446'></a> 446                 <strong class='reserved'>return</strong> <strong class='reserved'>false</strong>;
<a id='L447' name='L447'></a> 447         <em class='brace'>}</em>
<a id='L448' name='L448'></a> 448         <a href='../D/14441.html' title='Multiple defined in 2 places.'>shroud_clearer</a> <a href='../Y/7493.html' title='Multiple used in 26 places.'>clearer</a>;
<a id='L449' name='L449'></a> 449         <strong class='reserved'>bool</strong> <a href='../Y/7490.html' title='Multiple used in 3 places.'>cleared_shroud</a> = <strong class='reserved'>false</strong>;
<a id='L450' name='L450'></a> 450         <strong class='reserved'>const</strong> <a href='../Y/18828.html' title='Multiple used in 1745 places.'>size_t</a> <a href='../Y/13264.html' title='Multiple used in 2 places.'>list_size</a> = <a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>.<a href='../D/14560.html' title='Multiple defined in 18 places.'>size</a>();
<a id='L451' name='L451'></a> 451 
<a id='L452' name='L452'></a> 452 
<a id='L453' name='L453'></a> 453         <em class='comment'>// Loop through the list of undo_actions.</em>
<a id='L454' name='L454'></a> 454         <strong class='reserved'>for</strong>( <a href='../Y/18828.html' title='Multiple used in 1745 places.'>size_t</a> <a href='../D/8655.html' title='Multiple defined in 5 places.'>i</a> = 0; <a href='../D/8655.html' title='Multiple defined in 5 places.'>i</a> != <a href='../Y/13264.html' title='Multiple used in 2 places.'>list_size</a>; ++<a href='../D/8655.html' title='Multiple defined in 5 places.'>i</a> ) <em class='brace'>{</em>
<a id='L455' name='L455'></a> 455                 <strong class='reserved'>if</strong> (<strong class='reserved'>const</strong> <a href='../S/885.html#L23' title='Defined at 23 in src/actions/shroud_clearing_action.hpp.'>shroud_clearing_action</a>* <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a> = <strong class='reserved'>dynamic_cast</strong>&lt;<strong class='reserved'>const</strong> <a href='../S/885.html#L23' title='Defined at 23 in src/actions/shroud_clearing_action.hpp.'>shroud_clearing_action</a>*&gt;(&amp;<a href='../Y/21027.html' title='Multiple used in 17 places.'>undos_</a>[<a href='../D/8655.html' title='Multiple defined in 5 places.'>i</a>])) <em class='brace'>{</em>
<a id='L456' name='L456'></a> 456                         <a href='../D/1113.html' title='Multiple defined in 38 places.'>LOG_NG</a> &lt;&lt; "Turning an undo...\n";
<a id='L457' name='L457'></a> 457 
<a id='L458' name='L458'></a> 458                         <em class='comment'>// Clear the hexes this unit can see from each hex occupied during</em>
<a id='L459' name='L459'></a> 459                         <em class='comment'>// the action.</em>
<a id='L460' name='L460'></a> 460                         <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../Y/21571.html' title='Multiple used in 2732 places.'>vector</a>&lt;<a href='../S/1096.html#L40' title='Defined at 40 in src/map/location.hpp.'>map_location</a>&gt;::<a href='../D/4855.html' title='Multiple defined in 13 places.'>const_iterator</a> <a href='../D/14758.html' title='Multiple defined in 2 places.'>step</a>;
<a id='L461' name='L461'></a> 461                         <strong class='reserved'>for</strong> (<a href='../D/14758.html' title='Multiple defined in 2 places.'>step</a> = <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>-&gt;<a href='../Y/17801.html' title='Multiple used in 135 places.'>route</a>.<a href='../D/3617.html' title='Multiple defined in 28 places.'>begin</a>(); <a href='../D/14758.html' title='Multiple defined in 2 places.'>step</a> != <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>-&gt;<a href='../Y/17801.html' title='Multiple used in 135 places.'>route</a>.<a href='../D/5896.html' title='Multiple defined in 28 places.'>end</a>(); ++<a href='../D/14758.html' title='Multiple defined in 2 places.'>step</a>) <em class='brace'>{</em>
<a id='L462' name='L462'></a> 462                                 <em class='comment'>// Clear the shroud, collecting new sighted events.</em>
<a id='L463' name='L463'></a> 463                                 <em class='comment'>// (This can be made gradual by changing "true" to "false".)</em>
<a id='L464' name='L464'></a> 464                                 <strong class='reserved'>if</strong> ( <a href='../Y/7493.html' title='Multiple used in 26 places.'>clearer</a>.<a href='../D/4544.html' title='Multiple defined in 5 places.'>clear_unit</a>(*<a href='../D/14758.html' title='Multiple defined in 2 places.'>step</a>, <a href='../Y/20347.html' title='Multiple used in 149 places.'>tm</a>, <a href='../D/2764.html' title='Multiple defined in 10 places.'>action</a>-&gt;<a href='../Y/21641.html' title='Multiple used in 6 places.'>view_info</a>, <strong class='reserved'>true</strong>) ) <em class='brace'>{</em>
<a id='L465' name='L465'></a> 465                                         <a href='../Y/7490.html' title='Multiple used in 3 places.'>cleared_shroud</a> = <strong class='reserved'>true</strong>;
<a id='L466' name='L466'></a> 466                                 <em class='brace'>}</em>
<a id='L467' name='L467'></a> 467                         <em class='brace'>}</em>
<a id='L468' name='L468'></a> 468                 <em class='brace'>}</em>
<a id='L469' name='L469'></a> 469         <em class='brace'>}</em>
<a id='L470' name='L470'></a> 470 
<a id='L471' name='L471'></a> 471 
<a id='L472' name='L472'></a> 472         <strong class='reserved'>if</strong> (!<a href='../Y/7490.html' title='Multiple used in 3 places.'>cleared_shroud</a>) <em class='brace'>{</em>
<a id='L473' name='L473'></a> 473                 <strong class='reserved'>return</strong> <strong class='reserved'>false</strong>;
<a id='L474' name='L474'></a> 474         <em class='brace'>}</em>
<a id='L475' name='L475'></a> 475         <em class='comment'>// If we clear fog or shroud outside a synced context we get OOS</em>
<a id='L476' name='L476'></a> 476         <em class='comment'>// Note that it can happen that we call this function from ouside a synced context</em>
<a id='L477' name='L477'></a> 477         <em class='comment'>// when we reload  a game and want to prevent undoing. But in this case this is</em>
<a id='L478' name='L478'></a> 478         <em class='comment'>// preceeded by a manual update_shroud call so that cleared_shroud is false.</em>
<a id='L479' name='L479'></a> 479         <a href='../Y/5875.html' title='Multiple used in 1200 places.'>assert</a>(<a href='../S/747.html#L31' title='Defined at 31 in src/synced_context.hpp.'>synced_context</a>::<a href='../D/9463.html' title='Multiple defined in 2 places.'>is_synced</a>());
<a id='L480' name='L480'></a> 480 
<a id='L481' name='L481'></a> 481         <em class='comment'>// The entire stack needs to be cleared in order to preserve replays.</em>
<a id='L482' name='L482'></a> 482         <em class='comment'>// (The events that fired might depend on current unit positions.)</em>
<a id='L483' name='L483'></a> 483         <em class='comment'>// (Also the events that did not fire might depend on unit positions (they whould have fired if the unit would have standed on different positions, for example this can happen if they have a [have_unit] in [filter_condition]))</em>
<a id='L484' name='L484'></a> 484 
<a id='L485' name='L485'></a> 485         <em class='comment'>// Update the display before pumping events.</em>
<a id='L486' name='L486'></a> 486         <a href='../Y/7493.html' title='Multiple used in 26 places.'>clearer</a>.<a href='../S/907.html#L581' title='Defined at 581 in src/actions/vision.cpp.'>invalidate_after_clear</a>();
<a id='L487' name='L487'></a> 487         <a href='../S/1103.html#L157' title='Defined at 157 in src/halo.cpp.'>disp</a>.<a href='../D/5690.html' title='Multiple defined in 26 places.'>draw</a>();
<a id='L488' name='L488'></a> 488 
<a id='L489' name='L489'></a> 489         <em class='comment'>// Fire sighted events</em>
<a id='L490' name='L490'></a> 490         <strong class='reserved'>if</strong> ( <a href='../D/14757.html' title='Multiple defined in 5 places.'>std</a>::<a href='../D/6770.html' title='Multiple defined in 42 places.'>get</a>&lt;0&gt;(<a href='../Y/7493.html' title='Multiple used in 26 places.'>clearer</a>.<a href='../D/6375.html' title='Multiple defined in 2 places.'>fire_events</a>() )) <em class='brace'>{</em>
<a id='L491' name='L491'></a> 491                 <em class='comment'>// Fix up the display in case WML changed stuff.</em>
<a id='L492' name='L492'></a> 492                 <a href='../D/4533.html' title='Multiple defined in 2 places.'>clear_shroud</a>(<a href='../D/14455.html' title='Multiple defined in 2 places.'>side_</a>);
<a id='L493' name='L493'></a> 493                 <a href='../S/1103.html#L157' title='Defined at 157 in src/halo.cpp.'>disp</a>.<a href='../S/745.html#L124' title='Defined at 124 in src/game_display.hpp.'>invalidate_unit</a>();
<a id='L494' name='L494'></a> 494                 <a href='../S/1103.html#L157' title='Defined at 157 in src/halo.cpp.'>disp</a>.<a href='../D/5690.html' title='Multiple defined in 26 places.'>draw</a>();
<a id='L495' name='L495'></a> 495         <em class='brace'>}</em>
<a id='L496' name='L496'></a> 496 
<a id='L497' name='L497'></a> 497         <strong class='reserved'>return</strong> <strong class='reserved'>true</strong>;
<a id='L498' name='L498'></a> 498 <em class='brace'>}</em>
<a id='L499' name='L499'></a> 499 
<a id='L500' name='L500'></a> 500 
<a id='L501' name='L501'></a> 501 <em class='brace'>}</em><em class='comment'>//namespace actions</em>
<a id='L502' name='L502'></a> 502 
</pre>
<hr />
<a id='BOTTOM' name='BOTTOM'></a>
<em class='comment'>/* [&lt;][&gt;]<a href='#L71'>[^]</a><a href='#L440'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
</body>
</html>
