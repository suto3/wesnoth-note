<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>data/multiplayer/scenarios/2p_Dark_Forecast.lua</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.5.6' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<a id='TOP' name='TOP'></a><h2 class='header'><a href='../mains.html'>root</a>/<a href='../files/5634.html'>data</a>/<a href='../files/5778.html'>multiplayer</a>/<a href='../files/5780.html'>scenarios</a>/2p_Dark_Forecast.lua</h2>
<em class='comment'>/* [&lt;][&gt;]<a href='#L94'>[^]</a><a href='#L435'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
<hr />
<h2 class='header'>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L94' title='Defined at 94.'>get_spawn_types</a></li>
<li><a href='#L162' title='Defined at 162.'>create_timed_spaws</a></li>
<li><a href='#L214' title='Defined at 214.'>place_units</a></li>
<li><a href='#L245' title='Defined at 245.'>final_spawn</a></li>
<li><a href='#L368' title='Defined at 368.'>get_weather_duration</a></li>
<li><a href='#L424' title='Defined at 424.'>weather_alert</a></li>
<li><a href='#L435' title='Defined at 435.'>weather_map</a></li>
</ol>
<hr />
<pre>
<a id='L1' name='L1'></a>   1 
<a id='L2' name='L2'></a>   2 local <a href='../Y/11343.html' title='Multiple used in 348 places.'>helper</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/17279.html' title='Multiple used in 267 places.'>require</a>("helper")
<a id='L3' name='L3'></a>   3 local <a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/15042.html' title='Multiple defined in 2 places.'>textdomain</a> 'wesnoth-multiplayer'
<a id='L4' name='L4'></a>   4 local <a href='../D/2061.html' title='Multiple defined in 2 places.'>T</a> = <a href='../Y/11343.html' title='Multiple used in 348 places.'>helper</a>.<a href='../Y/18257.html' title='Multiple used in 21 places.'>set_wml_tag_metatable</a> <em class='brace'>{</em><em class='brace'>}</em>
<a id='L5' name='L5'></a>   5 local <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/17279.html' title='Multiple used in 267 places.'>require</a>("on_event")
<a id='L6' name='L6'></a>   6 
<a id='L7' name='L7'></a>   7 local <a href='../Y/16774.html' title='Multiple used in 3 places.'>random_spawns</a> = <em class='brace'>{</em>
<a id='L8' name='L8'></a>   8         <em class='brace'>{</em>
<a id='L9' name='L9'></a>   9                 <em class='brace'>{</em>"Heavy Infantryman", "Shock Trooper", "Iron Mauler", "none"<em class='brace'>}</em>,
<a id='L10' name='L10'></a>  10                 <em class='brace'>{</em>"Elvish Fighter", "Elvish Hero", "more", "Elvish Champion"<em class='brace'>}</em>,
<a id='L11' name='L11'></a>  11                 <em class='brace'>{</em>"Goblin Spearman", "more", "more", "more"<em class='brace'>}</em>,
<a id='L12' name='L12'></a>  12                 <em class='brace'>{</em>"Goblin Spearman", "Goblin Rouser", "none", "none"<em class='brace'>}</em>,
<a id='L13' name='L13'></a>  13                 <em class='brace'>{</em>"Elvish Fighter", "Elvish Captain", "Elvish Marshal", "none"<em class='brace'>}</em>,
<a id='L14' name='L14'></a>  14         <em class='brace'>}</em>,
<a id='L15' name='L15'></a>  15         <em class='brace'>{</em>
<a id='L16' name='L16'></a>  16                 <em class='brace'>{</em>"Mage", "Red Mage", "Silver Mage", "none"<em class='brace'>}</em>,
<a id='L17' name='L17'></a>  17                 <em class='brace'>{</em>"Footpad", "Outlaw", "more", "none"<em class='brace'>}</em>,
<a id='L18' name='L18'></a>  18                 <em class='brace'>{</em>"Drake Fighter", "Drake Warrior", "Drake Blademaster", "none"<em class='brace'>}</em>,
<a id='L19' name='L19'></a>  19                 <em class='brace'>{</em>"Walking Corpse", "more", "more", "more"<em class='brace'>}</em>,
<a id='L20' name='L20'></a>  20         <em class='brace'>}</em>,
<a id='L21' name='L21'></a>  21         <em class='brace'>{</em>
<a id='L22' name='L22'></a>  22                 <em class='brace'>{</em>"Merman Hunter", "Merman Spearman", "Merman Entangler", "none"<em class='brace'>}</em>,
<a id='L23' name='L23'></a>  23                 <em class='brace'>{</em>"Naga Fighter", "Naga Warrior", "Naga Myrmidon", "none"<em class='brace'>}</em>,
<a id='L24' name='L24'></a>  24                 <em class='brace'>{</em>"Spearman", "Pikeman", "none", "Halberdier"<em class='brace'>}</em>,
<a id='L25' name='L25'></a>  25         <em class='brace'>}</em>,
<a id='L26' name='L26'></a>  26         <em class='brace'>{</em>
<a id='L27' name='L27'></a>  27                 <em class='brace'>{</em>"Elvish Shaman", "Elvish Druid", "Elvish Shyde", "Elvish Sylph"<em class='brace'>}</em>,
<a id='L28' name='L28'></a>  28                 <em class='brace'>{</em>"Drake Burner", "Fire Drake", "Inferno Drake", "Armageddon Drake"<em class='brace'>}</em>,
<a id='L29' name='L29'></a>  29                 <em class='brace'>{</em>"Skeleton", "Revenant", "more", "Draug"<em class='brace'>}</em>,
<a id='L30' name='L30'></a>  30         <em class='brace'>}</em>,
<a id='L31' name='L31'></a>  31         <em class='brace'>{</em>
<a id='L32' name='L32'></a>  32                 <em class='brace'>{</em>"Giant Mudcrawler", "Sea Serpent", "none", "none"<em class='brace'>}</em>,
<a id='L33' name='L33'></a>  33                 <em class='brace'>{</em>"Mudcrawler", "more", "Giant Mudcrawler", "more"<em class='brace'>}</em>,
<a id='L34' name='L34'></a>  34         <em class='brace'>}</em>,
<a id='L35' name='L35'></a>  35         <em class='brace'>{</em>
<a id='L36' name='L36'></a>  36                 <em class='brace'>{</em>"Ghoul", "Necrophage", "more", "none"<em class='brace'>}</em>,
<a id='L37' name='L37'></a>  37                 <em class='brace'>{</em>"Elvish Archer", "Elvish Marksman", "none", "Elvish Sharpshooter"<em class='brace'>}</em>,
<a id='L38' name='L38'></a>  38                 <em class='brace'>{</em>"Elvish Archer", "Elvish Ranger", "Elvish Avenger", "none"<em class='brace'>}</em>,
<a id='L39' name='L39'></a>  39                 <em class='brace'>{</em>"Drake Clasher", "Drake Thrasher", "more", "Drake Enforcer"<em class='brace'>}</em>,
<a id='L40' name='L40'></a>  40         <em class='brace'>}</em>,
<a id='L41' name='L41'></a>  41         <em class='brace'>{</em>
<a id='L42' name='L42'></a>  42                 <em class='brace'>{</em>"Skeleton Archer", "Bone Shooter", "more", "Banebow"<em class='brace'>}</em>,
<a id='L43' name='L43'></a>  43                 <em class='brace'>{</em>"Fencer", "Duelist", "none", "Master at Arms"<em class='brace'>}</em>,
<a id='L44' name='L44'></a>  44                 <em class='brace'>{</em>"Drake Glider", "Sky Drake", "Hurricane Drake", "none"<em class='brace'>}</em>,
<a id='L45' name='L45'></a>  45         <em class='brace'>}</em>,
<a id='L46' name='L46'></a>  46         <em class='brace'>{</em>
<a id='L47' name='L47'></a>  47                 <em class='brace'>{</em>"Merman Fighter", "Merman Warrior", "more", "Merman Triton"<em class='brace'>}</em>,
<a id='L48' name='L48'></a>  48                 <em class='brace'>{</em>"Dark Adept", "Dark Sorcerer", "Necromancer", "none"<em class='brace'>}</em>,
<a id='L49' name='L49'></a>  49                 <em class='brace'>{</em>"Elvish Scout", "Elvish Rider", "more", "none"<em class='brace'>}</em>,
<a id='L50' name='L50'></a>  50         <em class='brace'>}</em>,
<a id='L51' name='L51'></a>  51         <em class='brace'>{</em>
<a id='L52' name='L52'></a>  52                 <em class='brace'>{</em>"Wose", "Elder Wose", "Ancient Wose", "none"<em class='brace'>}</em>,
<a id='L53' name='L53'></a>  53                 <em class='brace'>{</em>"Orcish Archer", "Orcish Crossbowman", "Orcish Slurbow", "none"<em class='brace'>}</em>,
<a id='L54' name='L54'></a>  54                 <em class='brace'>{</em>"Saurian Skirmisher", "more", "Saurian Ambusher", "more"<em class='brace'>}</em>,
<a id='L55' name='L55'></a>  55         <em class='brace'>}</em>,
<a id='L56' name='L56'></a>  56         <em class='brace'>{</em>
<a id='L57' name='L57'></a>  57                 <em class='brace'>{</em>"Orcish Grunt", "Orcish Warrior", "more", "none"<em class='brace'>}</em>,
<a id='L58' name='L58'></a>  58                 <em class='brace'>{</em>"Vampire Bat", "Blood Bat", "more", "none"<em class='brace'>}</em>,
<a id='L59' name='L59'></a>  59                 <em class='brace'>{</em>"Dwarvish Thunderer", "Dwarvish Thunderguard", "none", "none"<em class='brace'>}</em>,
<a id='L60' name='L60'></a>  60                 <em class='brace'>{</em>"Peasant", "more", "more", "more"<em class='brace'>}</em>,
<a id='L61' name='L61'></a>  61                 <em class='brace'>{</em>"Woodsman", "more", "Sergeant", "Orcish Ruler"<em class='brace'>}</em>,
<a id='L62' name='L62'></a>  62         <em class='brace'>}</em>,
<a id='L63' name='L63'></a>  63         <em class='brace'>{</em>
<a id='L64' name='L64'></a>  64                 <em class='brace'>{</em>"Dwarvish Guardsman", "Dwarvish Stalwart", "none", "none"<em class='brace'>}</em>,
<a id='L65' name='L65'></a>  65                 <em class='brace'>{</em>"Bowman", "Longbowman", "more", "Master Bowman"<em class='brace'>}</em>,
<a id='L66' name='L66'></a>  66                 <em class='brace'>{</em>"Troll Whelp", "Troll", "Troll Warrior", "none"<em class='brace'>}</em>,
<a id='L67' name='L67'></a>  67         <em class='brace'>}</em>,
<a id='L68' name='L68'></a>  68         <em class='brace'>{</em>
<a id='L69' name='L69'></a>  69                 <em class='brace'>{</em>"Orcish Assassin", "Orcish Slayer", "more", "none"<em class='brace'>}</em>,
<a id='L70' name='L70'></a>  70                 <em class='brace'>{</em>"Cavalryman", "Dragoon", "more", "Cavalier"<em class='brace'>}</em>,
<a id='L71' name='L71'></a>  71                 <em class='brace'>{</em>"Saurian Augur", "Saurian Soothsayer", "none", "none"<em class='brace'>}</em>,
<a id='L72' name='L72'></a>  72         <em class='brace'>}</em>,
<a id='L73' name='L73'></a>  73         <em class='brace'>{</em>
<a id='L74' name='L74'></a>  74                 <em class='brace'>{</em>"Wolf Rider", "Goblin Pillager", "more", "none"<em class='brace'>}</em>,
<a id='L75' name='L75'></a>  75                 <em class='brace'>{</em>"Ghost", "Shadow", "more", "more"<em class='brace'>}</em>,
<a id='L76' name='L76'></a>  76                 <em class='brace'>{</em>"Sergeant", "Lieutenant", "General", "Grand Marshal"<em class='brace'>}</em>,
<a id='L77' name='L77'></a>  77         <em class='brace'>}</em>,
<a id='L78' name='L78'></a>  78         <em class='brace'>{</em>
<a id='L79' name='L79'></a>  79                 <em class='brace'>{</em>"Gryphon Rider", "none", "more", "none"<em class='brace'>}</em>,
<a id='L80' name='L80'></a>  80                 <em class='brace'>{</em>"Thief", "Rogue", "more", "Assassin"<em class='brace'>}</em>,
<a id='L81' name='L81'></a>  81         <em class='brace'>}</em>,
<a id='L82' name='L82'></a>  82         <em class='brace'>{</em>
<a id='L83' name='L83'></a>  83                 <em class='brace'>{</em>"Dwarvish Fighter", "Dwarvish Steelclad", "more", "Dwarvish Lord"<em class='brace'>}</em>,
<a id='L84' name='L84'></a>  84                 <em class='brace'>{</em>"Poacher", "Trapper", "more", "none"<em class='brace'>}</em>,
<a id='L85' name='L85'></a>  85                 <em class='brace'>{</em>"Cuttle Fish", "more", "more", "none"<em class='brace'>}</em>,
<a id='L86' name='L86'></a>  86         <em class='brace'>}</em>,
<a id='L87' name='L87'></a>  87         <em class='brace'>{</em>
<a id='L88' name='L88'></a>  88                 <em class='brace'>{</em>"Walking Corpse", "more", "more", "more"<em class='brace'>}</em>,
<a id='L89' name='L89'></a>  89                 <em class='brace'>{</em>"Mage", "White Mage", "Mage of Light", "none"<em class='brace'>}</em>,
<a id='L90' name='L90'></a>  90                 <em class='brace'>{</em>"Thug", "Bandit", "more", "none"<em class='brace'>}</em>,
<a id='L91' name='L91'></a>  91         <em class='brace'>}</em>,
<a id='L92' name='L92'></a>  92 <em class='brace'>}</em>
<a id='L93' name='L93'></a>  93 
<a id='L94' name='L94'></a>  94 local function <a href='../S/4170.html#L286' title='Referred from 286 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>get_spawn_types</a>(<a href='../Y/15158.html' title='Multiple used in 9 places.'>num_units</a>, <a href='../Y/13737.html' title='Multiple used in 2 places.'>max_gold</a>, <a href='../Y/20820.html' title='Multiple used in 6 places.'>unit_pool</a>)
<a id='L95' name='L95'></a>  95         local <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> = <a href='../Y/13737.html' title='Multiple used in 2 places.'>max_gold</a>
<a id='L96' name='L96'></a>  96         local <a href='../Y/20865.html' title='Multiple used in 3 places.'>units_left</a> = <a href='../Y/15158.html' title='Multiple used in 9 places.'>num_units</a>
<a id='L97' name='L97'></a>  97         local <a href='../Y/8091.html' title='Multiple used in 6 places.'>current_types</a> = <em class='brace'>{</em><em class='brace'>}</em>
<a id='L98' name='L98'></a>  98         <strong class='reserved'>while</strong> <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> &gt; 0 and <a href='../Y/20865.html' title='Multiple used in 3 places.'>units_left</a> &gt; 0 <strong class='reserved'>do</strong>
<a id='L99' name='L99'></a>  99                 local <a href='../Y/20780.html' title='Multiple used in 3 places.'>unit_group</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(#<a href='../Y/20820.html' title='Multiple used in 6 places.'>unit_pool</a>)
<a id='L100' name='L100'></a> 100                 local <a href='../Y/20826.html' title='Multiple used in 2 places.'>unit_rank</a> = 1
<a id='L101' name='L101'></a> 101                 local <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/20846.html' title='Multiple used in 155 places.'>unit_types</a>[<a href='../Y/20820.html' title='Multiple used in 6 places.'>unit_pool</a>[<a href='../Y/20780.html' title='Multiple used in 3 places.'>unit_group</a>][<a href='../Y/20826.html' title='Multiple used in 2 places.'>unit_rank</a>]]
<a id='L102' name='L102'></a> 102                 table.insert(<a href='../Y/8091.html' title='Multiple used in 6 places.'>current_types</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../Y/20780.html' title='Multiple used in 3 places.'>unit_group</a>, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> =  <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a><em class='brace'>}</em>)
<a id='L103' name='L103'></a> 103                 <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> = gold_left - <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a>.<a href='../D/4907.html' title='Multiple defined in 12 places.'>cost</a>
<a id='L104' name='L104'></a> 104                 <a href='../Y/20865.html' title='Multiple used in 3 places.'>units_left</a> = units_left - 1
<a id='L105' name='L105'></a> 105         end
<a id='L106' name='L106'></a> 106         -- Upgrade units, eigher by replacing them with better units or by duplicating them.
<a id='L107' name='L107'></a> 107         <strong class='reserved'>for</strong> <a href='../Y/14882.html' title='Multiple used in 2 places.'>next_rank</a> = 2,4 <strong class='reserved'>do</strong>
<a id='L108' name='L108'></a> 108                 local <a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a> = <em class='brace'>{</em><em class='brace'>}</em>
<a id='L109' name='L109'></a> 109                 <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>,<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a>(<a href='../Y/8091.html' title='Multiple used in 6 places.'>current_types</a>) <strong class='reserved'>do</strong>
<a id='L110' name='L110'></a> 110                         local <a href='../Y/5306.html' title='Multiple used in 8 places.'>advanceto</a> = <a href='../Y/20820.html' title='Multiple used in 6 places.'>unit_pool</a>[<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.<a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a>][<a href='../Y/14882.html' title='Multiple used in 2 places.'>next_rank</a>] or ""
<a id='L111' name='L111'></a> 111                         local <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/20846.html' title='Multiple used in 155 places.'>unit_types</a>[<a href='../Y/5306.html' title='Multiple used in 8 places.'>advanceto</a>]
<a id='L112' name='L112'></a> 112                         <strong class='reserved'>if</strong> <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a> then
<a id='L113' name='L113'></a> 113                                 local <a href='../Y/20956.html' title='Multiple used in 6 places.'>upgrade_cost</a> = math.ceil((<a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a>.<a href='../D/4907.html' title='Multiple defined in 12 places.'>cost</a> - <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.<a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a>.cost) * 1.25)
<a id='L114' name='L114'></a> 114                                 <strong class='reserved'>if</strong> <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> &gt;= <a href='../Y/20956.html' title='Multiple used in 6 places.'>upgrade_cost</a> then
<a id='L115' name='L115'></a> 115                                         <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> = gold_left - <a href='../Y/20956.html' title='Multiple used in 6 places.'>upgrade_cost</a>
<a id='L116' name='L116'></a> 116                                         table.insert(<a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.group, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a><em class='brace'>}</em>)
<a id='L117' name='L117'></a> 117                                 <strong class='reserved'>else</strong>
<a id='L118' name='L118'></a> 118                                         table.insert(<a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.group, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = v.type<em class='brace'>}</em>)
<a id='L119' name='L119'></a> 119                                 end
<a id='L120' name='L120'></a> 120                         elseif <a href='../Y/5306.html' title='Multiple used in 8 places.'>advanceto</a> == "more" then
<a id='L121' name='L121'></a> 121                                 local <a href='../Y/20956.html' title='Multiple used in 6 places.'>upgrade_cost</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.<a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a>.<a href='../D/4907.html' title='Multiple defined in 12 places.'>cost</a> + 2
<a id='L122' name='L122'></a> 122                                 <strong class='reserved'>if</strong> <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> &gt;= <a href='../Y/20956.html' title='Multiple used in 6 places.'>upgrade_cost</a> then
<a id='L123' name='L123'></a> 123                                         <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> = gold_left - <a href='../Y/20956.html' title='Multiple used in 6 places.'>upgrade_cost</a>
<a id='L124' name='L124'></a> 124                                         table.insert(<a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.group, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = v.type<em class='brace'>}</em>)
<a id='L125' name='L125'></a> 125                                 end
<a id='L126' name='L126'></a> 126                                 table.insert(<a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.group, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = v.type<em class='brace'>}</em>)
<a id='L127' name='L127'></a> 127                         <strong class='reserved'>else</strong>
<a id='L128' name='L128'></a> 128                                 table.insert(<a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.group, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = v.type<em class='brace'>}</em>)
<a id='L129' name='L129'></a> 129                         end
<a id='L130' name='L130'></a> 130                 end
<a id='L131' name='L131'></a> 131                 <a href='../Y/8091.html' title='Multiple used in 6 places.'>current_types</a> = <a href='../Y/14891.html' title='Multiple used in 7 places.'>next_types</a>
<a id='L132' name='L132'></a> 132         end
<a id='L133' name='L133'></a> 133         --spend remaining gold
<a id='L134' name='L134'></a> 134         local <a href='../Y/13995.html' title='Multiple used in 7 places.'>min_cost</a> = 100
<a id='L135' name='L135'></a> 135         <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>,<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a>(<a href='../Y/20820.html' title='Multiple used in 6 places.'>unit_pool</a>) <strong class='reserved'>do</strong>
<a id='L136' name='L136'></a> 136                 <a href='../Y/13995.html' title='Multiple used in 7 places.'>min_cost</a> = math.min(min_cost, <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/20846.html' title='Multiple used in 155 places.'>unit_types</a>[<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>[1]].<a href='../D/4907.html' title='Multiple defined in 12 places.'>cost</a>)
<a id='L137' name='L137'></a> 137         end
<a id='L138' name='L138'></a> 138         <strong class='reserved'>while</strong> <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> &gt;= <a href='../Y/13995.html' title='Multiple used in 7 places.'>min_cost</a> <strong class='reserved'>do</strong>
<a id='L139' name='L139'></a> 139                 local <a href='../Y/16310.html' title='Multiple used in 5 places.'>possible_groups</a> = <em class='brace'>{</em><em class='brace'>}</em>
<a id='L140' name='L140'></a> 140                 <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>,<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a>(<a href='../Y/20820.html' title='Multiple used in 6 places.'>unit_pool</a>) <strong class='reserved'>do</strong>
<a id='L141' name='L141'></a> 141                         local <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/20846.html' title='Multiple used in 155 places.'>unit_types</a>[<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>[1]]
<a id='L142' name='L142'></a> 142                         <strong class='reserved'>if</strong> <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a>.<a href='../D/4907.html' title='Multiple defined in 12 places.'>cost</a> &lt;= <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> then
<a id='L143' name='L143'></a> 143                                 table.insert(<a href='../Y/16310.html' title='Multiple used in 5 places.'>possible_groups</a>, <em class='brace'>{</em> <a href='../S/543.html#L30' title='Defined at 30 in src/gui/widgets/group.hpp.'>group</a> = <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>, <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = <a href='../D/15520.html' title='Multiple defined in 3 places.'>unit_type</a><em class='brace'>}</em>)
<a id='L144' name='L144'></a> 144                         end
<a id='L145' name='L145'></a> 145                 end
<a id='L146' name='L146'></a> 146                 local <a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(#<a href='../Y/16310.html' title='Multiple used in 5 places.'>possible_groups</a>)
<a id='L147' name='L147'></a> 147                 table.insert(<a href='../Y/8091.html' title='Multiple used in 6 places.'>current_types</a>, <a href='../Y/16310.html' title='Multiple used in 5 places.'>possible_groups</a>[<a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>])
<a id='L148' name='L148'></a> 148                 <a href='../Y/10930.html' title='Multiple used in 10 places.'>gold_left</a> = gold_left - <a href='../Y/16310.html' title='Multiple used in 5 places.'>possible_groups</a>[<a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>].<a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a>.<a href='../D/4907.html' title='Multiple defined in 12 places.'>cost</a>
<a id='L149' name='L149'></a> 149         end
<a id='L150' name='L150'></a> 150         local <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a> = <em class='brace'>{</em><em class='brace'>}</em>
<a id='L151' name='L151'></a> 151         <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>,<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a>(<a href='../Y/8091.html' title='Multiple used in 6 places.'>current_types</a>) <strong class='reserved'>do</strong>
<a id='L152' name='L152'></a> 152                 table.insert(<a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a>, <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>.<a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a>.<a href='../D/8581.html' title='Multiple defined in 22 places.'>id</a>)
<a id='L153' name='L153'></a> 153         end
<a id='L154' name='L154'></a> 154         <strong class='reserved'>return</strong> <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a>
<a id='L155' name='L155'></a> 155 end
<a id='L156' name='L156'></a> 156 
<a id='L157' name='L157'></a> 157 -- creates the 'timed_spawn' wml array.
<a id='L158' name='L158'></a> 158 -- @a num_spawns: the total number of times units get spawned
<a id='L159' name='L159'></a> 159 -- @a interval: the number of turns between 2 spawns
<a id='L160' name='L160'></a> 160 -- @a base_gold_amount, gold_increment: used to cauculate the amount of gold available <strong class='reserved'>for</strong> each timed spawn
<a id='L161' name='L161'></a> 161 -- @a units_amount, gold_per_unit_amount: used to cauculate the number of units spawned in each timed spawn
<a id='L162' name='L162'></a> 162 local function <a href='../R/4441.html' title='Multiple referred from 2 places.'>create_timed_spaws</a>(<a href='../Y/12043.html' title='Multiple used in 16 places.'>interval</a>, <a href='../Y/15150.html' title='Multiple used in 3 places.'>num_spawns</a>, <a href='../Y/6149.html' title='Multiple used in 3 places.'>base_gold_amount</a>, <a href='../Y/10928.html' title='Multiple used in 3 places.'>gold_increment</a>, <a href='../Y/20862.html' title='Multiple used in 3 places.'>units_amount</a>, <a href='../Y/10934.html' title='Multiple used in 2 places.'>gold_per_unit_amount</a>)
<a id='L163' name='L163'></a> 163         local <a href='../Y/7671.html' title='Multiple used in 2 places.'>configure_gold_factor</a> = ((<a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("enemey_gold_factor") or 0) + 100)/100
<a id='L164' name='L164'></a> 164         local <a href='../Y/16773.html' title='Multiple used in 5 places.'>random_spawn_numbers</a> = <em class='brace'>{</em><em class='brace'>}</em>
<a id='L165' name='L165'></a> 165         <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a> = 1, #<a href='../Y/16774.html' title='Multiple used in 3 places.'>random_spawns</a> <strong class='reserved'>do</strong>
<a id='L166' name='L166'></a> 166                 table.insert(<a href='../Y/16773.html' title='Multiple used in 5 places.'>random_spawn_numbers</a>, <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>)
<a id='L167' name='L167'></a> 167         end
<a id='L168' name='L168'></a> 168         <a href='../Y/11343.html' title='Multiple used in 348 places.'>helper</a>.<a href='../D/14332.html' title='Multiple defined in 2 places.'>shuffle</a>(<a href='../Y/16773.html' title='Multiple used in 5 places.'>random_spawn_numbers</a>)
<a id='L169' name='L169'></a> 169         local <a href='../Y/9934.html' title='Multiple used in 3 places.'>final_turn</a> = math.ceil(((<a href='../Y/15150.html' title='Multiple used in 3 places.'>num_spawns</a> - 1) * <a href='../Y/12043.html' title='Multiple used in 16 places.'>interval</a> + 40 + <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(2,4))/2)
<a id='L170' name='L170'></a> 170         local <a href='../Y/9194.html' title='Multiple used in 5 places.'>end_spawns</a> = 0
<a id='L171' name='L171'></a> 171         <strong class='reserved'>for</strong> <a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a> = 1, <a href='../Y/15150.html' title='Multiple used in 3 places.'>num_spawns</a> <strong class='reserved'>do</strong>
<a id='L172' name='L172'></a> 172                 local <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = 3 + (<a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a> - 1) * <a href='../Y/12043.html' title='Multiple used in 16 places.'>interval</a>
<a id='L173' name='L173'></a> 173                 local <a href='../D/8184.html' title='Multiple defined in 3 places.'>gold</a> = <a href='../Y/6149.html' title='Multiple used in 3 places.'>base_gold_amount</a> + (<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> - 3) * <a href='../Y/10928.html' title='Multiple used in 3 places.'>gold_increment</a>
<a id='L174' name='L174'></a> 174                 <strong class='reserved'>if</strong> <a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a> &gt; 1 then
<a id='L175' name='L175'></a> 175                         -- foruma taken from original Dark forecast, TODO: find easier formula.
<a id='L176' name='L176'></a> 176                         local <a href='../Y/20779.html' title='Multiple used in 2 places.'>unit_gold</a> = (<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> - 3) * <a href='../Y/10928.html' title='Multiple used in 3 places.'>gold_increment</a> + math.min(<a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(<a href='../Y/6149.html' title='Multiple used in 3 places.'>base_gold_amount</a>), wesnoth.random(base_gold_amount))
<a id='L177' name='L177'></a> 177                         local <a href='../Y/10933.html' title='Multiple used in 2 places.'>gold_per_unit</a> = <a href='../Y/10934.html' title='Multiple used in 2 places.'>gold_per_unit_amount</a> + <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> / 1.5
<a id='L178' name='L178'></a> 178                         local <a href='../D/15529.html' title='Multiple defined in 8 places.'>units</a> = <a href='../Y/20779.html' title='Multiple used in 2 places.'>unit_gold</a> / <a href='../Y/10933.html' title='Multiple used in 2 places.'>gold_per_unit</a> + <a href='../Y/20862.html' title='Multiple used in 3 places.'>units_amount</a> + <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(-1, 2)
<a id='L179' name='L179'></a> 179                         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(5) == 5 then
<a id='L180' name='L180'></a> 180                                 <a href='../D/15529.html' title='Multiple defined in 8 places.'>units</a> = units - 1
<a id='L181' name='L181'></a> 181                         end
<a id='L182' name='L182'></a> 182                         -- end complicated formula
<a id='L183' name='L183'></a> 183                         <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn + <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(-1, 1)
<a id='L184' name='L184'></a> 184                         -- reduce gold and units <strong class='reserved'>for</strong> spawns after the final spawn
<a id='L185' name='L185'></a> 185                         <strong class='reserved'>if</strong> <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> &gt;= <a href='../Y/9934.html' title='Multiple used in 3 places.'>final_turn</a> then
<a id='L186' name='L186'></a> 186                                 <a href='../D/15529.html' title='Multiple defined in 8 places.'>units</a> = units / (<a href='../Y/9194.html' title='Multiple used in 5 places.'>end_spawns</a> + 3)
<a id='L187' name='L187'></a> 187                                 <a href='../D/8184.html' title='Multiple defined in 3 places.'>gold</a> = gold / (<a href='../Y/9194.html' title='Multiple used in 5 places.'>end_spawns</a> + 4)
<a id='L188' name='L188'></a> 188                                 <a href='../Y/9194.html' title='Multiple used in 5 places.'>end_spawns</a> = end_spawns + 1
<a id='L189' name='L189'></a> 189                                 -- we only want two spawns after the final turn.
<a id='L190' name='L190'></a> 190                                 <strong class='reserved'>if</strong> <a href='../Y/9194.html' title='Multiple used in 5 places.'>end_spawns</a> &gt; 2 then
<a id='L191' name='L191'></a> 191                                         <strong class='reserved'>break</strong>
<a id='L192' name='L192'></a> 192                                 end
<a id='L193' name='L193'></a> 193                         end
<a id='L194' name='L194'></a> 194                         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>(string.format("timed_spawn[%d]", <a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a> - 1), <em class='brace'>{</em>
<a id='L195' name='L195'></a> 195                                 <a href='../D/15529.html' title='Multiple defined in 8 places.'>units</a> = math.ceil(units),
<a id='L196' name='L196'></a> 196                                 <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn,
<a id='L197' name='L197'></a> 197                                 <a href='../D/8184.html' title='Multiple defined in 3 places.'>gold</a> = <a href='../Y/11343.html' title='Multiple used in 348 places.'>helper</a>.<a href='../Y/17519.html' title='Multiple used in 32 places.'>round</a>(gold * <a href='../Y/7671.html' title='Multiple used in 2 places.'>configure_gold_factor</a>),
<a id='L198' name='L198'></a> 198                                 <a href='../Y/16265.html' title='Multiple used in 3 places.'>pool_num</a> = <a href='../Y/16773.html' title='Multiple used in 5 places.'>random_spawn_numbers</a>[<a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a>],
<a id='L199' name='L199'></a> 199                         <em class='brace'>}</em>)
<a id='L200' name='L200'></a> 200                 <strong class='reserved'>else</strong>
<a id='L201' name='L201'></a> 201                         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>(string.format("timed_spawn[%d]", <a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a> - 1), <em class='brace'>{</em>
<a id='L202' name='L202'></a> 202                                 <a href='../D/15529.html' title='Multiple defined in 8 places.'>units</a> = <a href='../Y/20862.html' title='Multiple used in 3 places.'>units_amount</a> + 1,
<a id='L203' name='L203'></a> 203                                 <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn,
<a id='L204' name='L204'></a> 204                                 <a href='../D/8184.html' title='Multiple defined in 3 places.'>gold</a> = gold,
<a id='L205' name='L205'></a> 205                                 <a href='../Y/16265.html' title='Multiple used in 3 places.'>pool_num</a> = <a href='../Y/16773.html' title='Multiple used in 5 places.'>random_spawn_numbers</a>[<a href='../Y/18727.html' title='Multiple used in 7 places.'>spawn_number</a>],
<a id='L206' name='L206'></a> 206                         <em class='brace'>}</em>)
<a id='L207' name='L207'></a> 207                 end
<a id='L208' name='L208'></a> 208         end
<a id='L209' name='L209'></a> 209         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>("final_turn", <a href='../Y/9934.html' title='Multiple used in 3 places.'>final_turn</a>)
<a id='L210' name='L210'></a> 210 end
<a id='L211' name='L211'></a> 211 
<a id='L212' name='L212'></a> 212 -- @a unittypes: a array of strings
<a id='L213' name='L213'></a> 213 -- @a x,y: the location where to spawn the units on the map.
<a id='L214' name='L214'></a> 214 local function <a href='../R/10736.html' title='Multiple referred from 3 places.'>place_units</a>(<a href='../Y/20877.html' title='Multiple used in 2 places.'>unittypes</a>, <a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a>, <a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a>)
<a id='L215' name='L215'></a> 215         <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>,<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a>(<a href='../Y/20877.html' title='Multiple used in 2 places.'>unittypes</a>) <strong class='reserved'>do</strong>
<a id='L216' name='L216'></a> 216                 local <a href='../Y/20595.html' title='Multiple used in 1983 places.'>u</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/5085.html' title='Multiple defined in 3 places.'>create_unit</a> <em class='brace'>{</em> <a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a>, <a href='../D/6648.html' title='Multiple defined in 3 places.'>generate_name</a> = true, <a href='../D/14339.html' title='Multiple defined in 3 places.'>side</a> = 2 <em class='brace'>}</em>
<a id='L217' name='L217'></a> 217                 <a href='../Y/20595.html' title='Multiple used in 1983 places.'>u</a>:<a href='../S/1007.html#L2148' title='Defined at 2148 in src/units/unit.cpp.'>add_modification</a>("object", <em class='brace'>{</em>
<a id='L218' name='L218'></a> 218                         <a href='../D/2061.html' title='Multiple defined in 2 places.'>T</a>.<a href='../D/5792.html' title='Multiple defined in 2 places.'>effect</a> <em class='brace'>{</em>
<a id='L219' name='L219'></a> 219                                 <a href='../Y/5653.html' title='Multiple used in 428 places.'>apply_to</a> = "movement_costs",
<a id='L220' name='L220'></a> 220                                 <a href='../D/12668.html' title='Multiple defined in 3 places.'>replace</a> = true,
<a id='L221' name='L221'></a> 221                                 <a href='../D/2061.html' title='Multiple defined in 2 places.'>T</a>.movement_costs <em class='brace'>{</em>
<a id='L222' name='L222'></a> 222                                         <a href='../Y/10065.html' title='Multiple used in 109 places.'>flat</a> = 1,
<a id='L223' name='L223'></a> 223                                         <a href='../Y/17664.html' title='Multiple used in 85 places.'>sand</a> = 2,
<a id='L224' name='L224'></a> 224                                         <a href='../Y/10198.html' title='Multiple used in 117 places.'>forest</a> = 2,
<a id='L225' name='L225'></a> 225                                         <a href='../Y/11761.html' title='Multiple used in 13 places.'>impassable</a> = 3,
<a id='L226' name='L226'></a> 226                                         <a href='../Y/20920.html' title='Multiple used in 24 places.'>unwalkable</a> = 3,
<a id='L227' name='L227'></a> 227                                         <a href='../Y/8290.html' title='Multiple used in 54 places.'>deep_water</a> = 3,
<a id='L228' name='L228'></a> 228                                 <em class='brace'>}</em>
<a id='L229' name='L229'></a> 229                         <em class='brace'>}</em>
<a id='L230' name='L230'></a> 230                 <em class='brace'>}</em>)
<a id='L231' name='L231'></a> 231                 -- give the unit less moves on its first turn.
<a id='L232' name='L232'></a> 232                 <a href='../Y/20595.html' title='Multiple used in 1983 places.'>u</a>.<a href='../D/14629.html' title='Multiple defined in 5 places.'>status</a>.<a href='../S/988.html#L750' title='Defined at 750 in src/units/unit.hpp.'>slowed</a> = true
<a id='L233' name='L233'></a> 233                 <a href='../Y/20595.html' title='Multiple used in 1983 places.'>u</a>:<a href='../S/1007.html#L2148' title='Defined at 2148 in src/units/unit.cpp.'>add_modification</a>("object", <em class='brace'>{</em>
<a id='L234' name='L234'></a> 234                         <a href='../D/5715.html' title='Multiple defined in 4 places.'>duration</a> = "turn end",
<a id='L235' name='L235'></a> 235                         <a href='../D/2061.html' title='Multiple defined in 2 places.'>T</a>.<a href='../D/5792.html' title='Multiple defined in 2 places.'>effect</a> <em class='brace'>{</em>
<a id='L236' name='L236'></a> 236                                 <a href='../Y/5653.html' title='Multiple used in 428 places.'>apply_to</a> = "movement",
<a id='L237' name='L237'></a> 237                                 <a href='../Y/11829.html' title='Multiple used in 65 places.'>increase</a> = "-50%",
<a id='L238' name='L238'></a> 238                         <em class='brace'>}</em>
<a id='L239' name='L239'></a> 239                 <em class='brace'>}</em>)
<a id='L240' name='L240'></a> 240                 local <a href='../Y/8956.html' title='Multiple used in 11 places.'>dst_x</a>, <a href='../Y/8957.html' title='Multiple used in 11 places.'>dst_y</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../S/848.html#L54' title='Defined at 54 in src/pathfind/pathfind.cpp.'>find_vacant_tile</a>(<a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a>, <a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a>, <a href='../Y/20595.html' title='Multiple used in 1983 places.'>u</a>)
<a id='L241' name='L241'></a> 241                 <a href='../Y/20595.html' title='Multiple used in 1983 places.'>u</a>:<a href='../Y/20144.html' title='Multiple used in 3 places.'>to_map</a>(<a href='../Y/8956.html' title='Multiple used in 11 places.'>dst_x</a>, <a href='../Y/8957.html' title='Multiple used in 11 places.'>dst_y</a>)
<a id='L242' name='L242'></a> 242         end
<a id='L243' name='L243'></a> 243 end
<a id='L244' name='L244'></a> 244 
<a id='L245' name='L245'></a> 245 local function <a href='../R/5506.html' title='Multiple referred from 2 places.'>final_spawn</a>()
<a id='L246' name='L246'></a> 246         local <a href='../Y/18729.html' title='Multiple used in 3 places.'>spawns_left</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("fixed_spawn.length")
<a id='L247' name='L247'></a> 247         <strong class='reserved'>if</strong> <a href='../Y/18729.html' title='Multiple used in 3 places.'>spawns_left</a> == 0 then
<a id='L248' name='L248'></a> 248                 <strong class='reserved'>return</strong>
<a id='L249' name='L249'></a> 249         end
<a id='L250' name='L250'></a> 250         local <a href='../Y/18726.html' title='Multiple used in 3 places.'>spawn_index</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(<a href='../Y/18729.html' title='Multiple used in 3 places.'>spawns_left</a>) - 1
<a id='L251' name='L251'></a> 251         local <a href='../Y/18723.html' title='Multiple used in 3 places.'>spawn</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>(string.format("fixed_spawn[%d]", <a href='../Y/18726.html' title='Multiple used in 3 places.'>spawn_index</a>))
<a id='L252' name='L252'></a> 252         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>(string.format("fixed_spawn[%d]", <a href='../Y/18726.html' title='Multiple used in 3 places.'>spawn_index</a>))
<a id='L253' name='L253'></a> 253         local <a href='../S/1014.html#L319' title='Defined at 319 in src/units/types.hpp.'>types</a> = <em class='brace'>{</em><em class='brace'>}</em>
<a id='L254' name='L254'></a> 254         <strong class='reserved'>for</strong> <a href='../Y/19353.html' title='Multiple used in 340 places.'>tag</a> in <a href='../Y/11343.html' title='Multiple used in 348 places.'>helper</a>.<a href='../D/4386.html' title='Multiple defined in 2 places.'>child_range</a>(<a href='../Y/18723.html' title='Multiple used in 3 places.'>spawn</a>, "type") <strong class='reserved'>do</strong>
<a id='L255' name='L255'></a> 255                 table.insert(<a href='../S/1014.html#L319' title='Defined at 319 in src/units/types.hpp.'>types</a>, <a href='../Y/19353.html' title='Multiple used in 340 places.'>tag</a>.<a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a>)
<a id='L256' name='L256'></a> 256         end
<a id='L257' name='L257'></a> 257         <a href='../D/11810.html' title='Multiple defined in 2 places.'>place_units</a>(<a href='../S/1014.html#L319' title='Defined at 319 in src/units/types.hpp.'>types</a>, <a href='../Y/18723.html' title='Multiple used in 3 places.'>spawn</a>.<a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a>, spawn.<a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a>)
<a id='L258' name='L258'></a> 258 end
<a id='L259' name='L259'></a> 259 
<a id='L260' name='L260'></a> 260 -- convert all 'veteran' units from side 2 to the more agressive side 1
<a id='L261' name='L261'></a> 261 -- this must happen before the new units are created from spawns.
<a id='L262' name='L262'></a> 262 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("new turn", function()
<a id='L263' name='L263'></a> 263         <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>, <a href='../D/15427.html' title='Multiple defined in 4 places.'>unit</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a>(<a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/8042.html' title='Multiple defined in 3 places.'>get_units</a> <em class='brace'>{</em> <a href='../D/14339.html' title='Multiple defined in 3 places.'>side</a> = 2 <em class='brace'>}</em>) <strong class='reserved'>do</strong>
<a id='L264' name='L264'></a> 264                 <a href='../D/15427.html' title='Multiple defined in 4 places.'>unit</a>.<a href='../D/14339.html' title='Multiple defined in 3 places.'>side</a> = 1
<a id='L265' name='L265'></a> 265         end
<a id='L266' name='L266'></a> 266 end)
<a id='L267' name='L267'></a> 267 
<a id='L268' name='L268'></a> 268 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("prestart", function()
<a id='L269' name='L269'></a> 269         local <a href='../Y/12892.html' title='Multiple used in 44 places.'>leaders</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/8042.html' title='Multiple defined in 3 places.'>get_units</a> <em class='brace'>{</em> <a href='../D/14339.html' title='Multiple defined in 3 places.'>side</a> = "3,4", <a href='../Y/6955.html' title='Multiple used in 1425 places.'>canrecruit</a>= true<em class='brace'>}</em>
<a id='L270' name='L270'></a> 270         <strong class='reserved'>if</strong> #<a href='../Y/12892.html' title='Multiple used in 44 places.'>leaders</a> &lt; 2 then
<a id='L271' name='L271'></a> 271                 <a href='../S/4170.html#L162' title='Defined at 162 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>create_timed_spaws</a>(5, 11, 50, 5, 4, 21)
<a id='L272' name='L272'></a> 272         <strong class='reserved'>else</strong>
<a id='L273' name='L273'></a> 273                 <a href='../S/4170.html#L162' title='Defined at 162 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>create_timed_spaws</a>(4, 11, 90, 4, 5, 23)
<a id='L274' name='L274'></a> 274         end
<a id='L275' name='L275'></a> 275 end)
<a id='L276' name='L276'></a> 276 
<a id='L277' name='L277'></a> 277 -- the regular spawns:
<a id='L278' name='L278'></a> 278 --   when they appear is defined in the 'timed_spawn' wml array. which is created at prestart
<a id='L279' name='L279'></a> 279 --   which unit types get spawned is defined in the 'main_spawn' wml array which is also spawned at prestart
<a id='L280' name='L280'></a> 280 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("new turn", function()
<a id='L281' name='L281'></a> 281         local <a href='../Y/14887.html' title='Multiple used in 3 places.'>next_spawn</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("timed_spawn[0]")
<a id='L282' name='L282'></a> 282         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> ~= <a href='../Y/14887.html' title='Multiple used in 3 places.'>next_spawn</a>.turn then
<a id='L283' name='L283'></a> 283                 <strong class='reserved'>return</strong>
<a id='L284' name='L284'></a> 284         end
<a id='L285' name='L285'></a> 285         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>("timed_spawn[0]")
<a id='L286' name='L286'></a> 286         local <a href='../Y/20846.html' title='Multiple used in 155 places.'>unit_types</a> = <a href='../S/4170.html#L94' title='Defined at 94 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>get_spawn_types</a>(<a href='../Y/14887.html' title='Multiple used in 3 places.'>next_spawn</a>.<a href='../D/15529.html' title='Multiple defined in 8 places.'>units</a>, next_spawn.<a href='../D/8184.html' title='Multiple defined in 3 places.'>gold</a>, <a href='../Y/16774.html' title='Multiple used in 3 places.'>random_spawns</a>[next_spawn.<a href='../Y/16265.html' title='Multiple used in 3 places.'>pool_num</a>])
<a id='L287' name='L287'></a> 287         local <a href='../Y/18725.html' title='Multiple used in 2 places.'>spawn_areas</a> = <em class='brace'>{</em><em class='brace'>{</em>"3-14", "15"<em class='brace'>}</em>, <em class='brace'>{</em>"1", "4-13"<em class='brace'>}</em>, <em class='brace'>{</em>"2-13", "1"<em class='brace'>}</em>, <em class='brace'>{</em>"1", "2-15"<em class='brace'>}</em><em class='brace'>}</em>
<a id='L288' name='L288'></a> 288         local <a href='../Y/18724.html' title='Multiple used in 2 places.'>spawn_area</a> = <a href='../Y/18725.html' title='Multiple used in 2 places.'>spawn_areas</a>[<a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(#spawn_areas)]
<a id='L289' name='L289'></a> 289         local <a href='../Y/13185.html' title='Multiple used in 2 places.'>locations_in_area</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/7632.html' title='Multiple defined in 2 places.'>get_locations</a> <em class='brace'>{</em> <a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a> = <a href='../Y/18724.html' title='Multiple used in 2 places.'>spawn_area</a>[1], <a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a> = spawn_area[2], <a href='../Y/16745.html' title='Multiple used in 315 places.'>radius</a>=1, <a href='../Y/11801.html' title='Multiple used in 5 places.'>include_borders</a>=false <em class='brace'>}</em>
<a id='L290' name='L290'></a> 290         local <a href='../Y/7286.html' title='Multiple used in 2 places.'>chosen_location</a> = <a href='../Y/13185.html' title='Multiple used in 2 places.'>locations_in_area</a>[<a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(#locations_in_area)]
<a id='L291' name='L291'></a> 291         <a href='../D/11810.html' title='Multiple defined in 2 places.'>place_units</a>(<a href='../Y/20846.html' title='Multiple used in 155 places.'>unit_types</a>, <a href='../Y/7286.html' title='Multiple used in 2 places.'>chosen_location</a>[1], chosen_location[2])
<a id='L292' name='L292'></a> 292 end)
<a id='L293' name='L293'></a> 293 
<a id='L294' name='L294'></a> 294 -- on turn 'final_turn' the first 'final spawn' appears
<a id='L295' name='L295'></a> 295 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("new turn", function()
<a id='L296' name='L296'></a> 296         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> ~= wesnoth.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("final_turn") then
<a id='L297' name='L297'></a> 297                 <strong class='reserved'>return</strong>
<a id='L298' name='L298'></a> 298         end
<a id='L299' name='L299'></a> 299         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../S/750.html#L284' title='Defined at 284 in src/storyscreen/part.hpp.'>music</a> <em class='brace'>{</em>
<a id='L300' name='L300'></a> 300                 <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "battle.ogg",
<a id='L301' name='L301'></a> 301                 <a href='../S/924.html#L42' title='Defined at 42 in src/sound_music_track.hpp.'>ms_before</a> = 200,
<a id='L302' name='L302'></a> 302                 <a href='../S/924.html#L39' title='Defined at 39 in src/sound_music_track.hpp.'>immediate</a> = true,
<a id='L303' name='L303'></a> 303                 <a href='../D/3287.html' title='Multiple defined in 8 places.'>append</a> = true,
<a id='L304' name='L304'></a> 304         <em class='brace'>}</em>
<a id='L305' name='L305'></a> 305         <a href='../S/4170.html#L245' title='Defined at 245 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>final_spawn</a>()
<a id='L306' name='L306'></a> 306         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/6549.html' title='Multiple defined in 7 places.'>game_config</a>.<a href='../Y/12721.html' title='Multiple used in 4 places.'>last_turn</a> = wesnoth.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> + 12
<a id='L307' name='L307'></a> 307         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/10869.html' title='Multiple defined in 7 places.'>message</a> <em class='brace'>{</em>
<a id='L308' name='L308'></a> 308                 <a href='../D/14339.html' title='Multiple defined in 3 places.'>side</a>="3,4",
<a id='L309' name='L309'></a> 309                 <a href='../Y/6955.html' title='Multiple used in 1425 places.'>canrecruit</a>=true,
<a id='L310' name='L310'></a> 310                 <a href='../D/10869.html' title='Multiple defined in 7 places.'>message</a>= <a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a> "The last and most powerful of these creatures are almost upon us. I feel that if we can finish them off in time, we shall be victorious.",
<a id='L311' name='L311'></a> 311         <em class='brace'>}</em>
<a id='L312' name='L312'></a> 312 end)
<a id='L313' name='L313'></a> 313 
<a id='L314' name='L314'></a> 314 -- after the first final spawn, spawn a new final spawn every 1 or 2 turns.
<a id='L315' name='L315'></a> 315 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("new turn", function()
<a id='L316' name='L316'></a> 316         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> ~= wesnoth.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("next_final_spawn") then
<a id='L317' name='L317'></a> 317                 <strong class='reserved'>return</strong>
<a id='L318' name='L318'></a> 318         end
<a id='L319' name='L319'></a> 319         <a href='../S/4170.html#L245' title='Defined at 245 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>final_spawn</a>()
<a id='L320' name='L320'></a> 320         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>("next_final_spawn", wesnoth.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> + wesnoth.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(1,2))
<a id='L321' name='L321'></a> 321 end)
<a id='L322' name='L322'></a> 322 
<a id='L323' name='L323'></a> 323 -- The victory condition: win when there are no enemy unit after the first final spawn appeared.
<a id='L324' name='L324'></a> 324 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("die", function()
<a id='L325' name='L325'></a> 325         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> &lt; wesnoth.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("final_turn") then
<a id='L326' name='L326'></a> 326                 <strong class='reserved'>return</strong>
<a id='L327' name='L327'></a> 327         end
<a id='L328' name='L328'></a> 328         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21757.html' title='Multiple used in 3 places.'>wml_conditionals</a>.<a href='../S/1071.html#L47' title='Defined at 47 in src/game_events/conditional_wml.cpp.'>have_unit</a> <em class='brace'>{</em> <a href='../D/14339.html' title='Multiple defined in 3 places.'>side</a> = "1,2"<em class='brace'>}</em> then
<a id='L329' name='L329'></a> 329                 <strong class='reserved'>return</strong>
<a id='L330' name='L330'></a> 330         end
<a id='L331' name='L331'></a> 331         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../S/750.html#L284' title='Defined at 284 in src/storyscreen/part.hpp.'>music</a> <em class='brace'>{</em>
<a id='L332' name='L332'></a> 332                 <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "victory.ogg",
<a id='L333' name='L333'></a> 333                 <a href='../S/924.html#L41' title='Defined at 41 in src/sound_music_track.hpp.'>play_once</a> = true,
<a id='L334' name='L334'></a> 334                 <a href='../S/924.html#L39' title='Defined at 39 in src/sound_music_track.hpp.'>immediate</a> = true,
<a id='L335' name='L335'></a> 335         <em class='brace'>}</em>
<a id='L336' name='L336'></a> 336         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/10869.html' title='Multiple defined in 7 places.'>message</a> <em class='brace'>{</em>
<a id='L337' name='L337'></a> 337                 <a href='../Y/18730.html' title='Multiple used in 8904 places.'>speaker</a> = "narrator",
<a id='L338' name='L338'></a> 338                 <a href='../D/10869.html' title='Multiple defined in 7 places.'>message</a> = <a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a>"The screams and pleas for mercy are finally silenced, as you remove your blood soaked blade from the last of the rebels. There will be no more resistance from the local scum. Your reign has finally earned stability.",
<a id='L339' name='L339'></a> 339                 <a href='../D/8612.html' title='Multiple defined in 19 places.'>image</a> ="wesnoth-icon.png",
<a id='L340' name='L340'></a> 340         <em class='brace'>}</em>
<a id='L341' name='L341'></a> 341         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../Y/9215.html' title='Multiple used in 2 places.'>endlevel</a> <em class='brace'>{</em>
<a id='L342' name='L342'></a> 342                 <a href='../D/12835.html' title='Multiple defined in 10 places.'>result</a> = "victory",
<a id='L343' name='L343'></a> 343         <em class='brace'>}</em>
<a id='L344' name='L344'></a> 344 end)
<a id='L345' name='L345'></a> 345 
<a id='L346' name='L346'></a> 346 -- initilize the 'fixed_spawn' and 'main_spawn'
<a id='L347' name='L347'></a> 347 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("prestart", function()
<a id='L348' name='L348'></a> 348         local <a href='../R/5620.html' title='Multiple referred from 4 places.'>fixed_spawn</a> = function(<a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a>, <a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a>, ...)
<a id='L349' name='L349'></a> 349                 local <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a> = <em class='brace'>{</em> <a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a> = x, <a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a> = y <em class='brace'>}</em>
<a id='L350' name='L350'></a> 350                 <strong class='reserved'>for</strong> <a href='../D/8570.html' title='Multiple defined in 5 places.'>i</a>,<a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> in <a href='../Y/12100.html' title='Multiple used in 428 places.'>ipairs</a> <em class='brace'>{</em>...<em class='brace'>}</em> <strong class='reserved'>do</strong>
<a id='L351' name='L351'></a> 351                         table.insert(<a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a>, <a href='../D/2061.html' title='Multiple defined in 2 places.'>T</a>.<a href='../D/15340.html' title='Multiple defined in 27 places.'>type</a> <em class='brace'>{</em> type = <a href='../Y/21104.html' title='Multiple used in 1396 places.'>v</a> <em class='brace'>}</em>)
<a id='L352' name='L352'></a> 352                 end
<a id='L353' name='L353'></a> 353                 <strong class='reserved'>return</strong> <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a>
<a id='L354' name='L354'></a> 354         end
<a id='L355' name='L355'></a> 355         <a href='../Y/11343.html' title='Multiple used in 348 places.'>helper</a>.<a href='../Y/18253.html' title='Multiple used in 4 places.'>set_variable_array</a>("fixed_spawn", <em class='brace'>{</em>
<a id='L356' name='L356'></a> 356                 <a href='../S/4170.html#L348' title='Defined at 348 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>fixed_spawn</a>(1, 15, "Fire Dragon", "Gryphon Master", "Hurricane Drake"),
<a id='L357' name='L357'></a> 357                 <a href='../S/4170.html#L348' title='Defined at 348 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>fixed_spawn</a>(5, 1, "Yeti", "Elvish Druid", "Elvish Druid"),
<a id='L358' name='L358'></a> 358                 <a href='../S/4170.html#L348' title='Defined at 348 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>fixed_spawn</a>(1, 7, "Lich", "Walking Corpse", "Walking Corpse", "Walking Corpse", "Ghoul", "Soulless", "Walking Corpse", "Walking Corpse", "Walking Corpse"),
<a id='L359' name='L359'></a> 359                 <a href='../S/4170.html#L348' title='Defined at 348 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>fixed_spawn</a>(11, 15, "Elvish Champion", "Dwarvish Stalwart", "Dwarvish Stalwart", "Orcish Slayer"),
<a id='L360' name='L360'></a> 360         <em class='brace'>}</em>)
<a id='L361' name='L361'></a> 361 end)
<a id='L362' name='L362'></a> 362 
<a id='L363' name='L363'></a> 363 -------------------------------------------------------------------------------
<a id='L364' name='L364'></a> 364 -------------------------- Weather events -------------------------------------
<a id='L365' name='L365'></a> 365 -------------------------------------------------------------------------------
<a id='L366' name='L366'></a> 366 -- The weather evens are complateleey unrelated to the spawn events.
<a id='L367' name='L367'></a> 367 
<a id='L368' name='L368'></a> 368 local function <a href='../R/7270.html' title='Multiple referred from 3 places.'>get_weather_duration</a>(<a href='../Y/13732.html' title='Multiple used in 2 places.'>max_duration</a>)
<a id='L369' name='L369'></a> 369         local <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(2)
<a id='L370' name='L370'></a> 370         <strong class='reserved'>while</strong> <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a> &lt; <a href='../Y/13732.html' title='Multiple used in 2 places.'>max_duration</a> and <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(2) == 2 <strong class='reserved'>do</strong>
<a id='L371' name='L371'></a> 371                 <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a> = res + 1
<a id='L372' name='L372'></a> 372         end
<a id='L373' name='L373'></a> 373         <strong class='reserved'>return</strong> <a href='../Y/17295.html' title='Multiple used in 1875 places.'>res</a>
<a id='L374' name='L374'></a> 374 end
<a id='L375' name='L375'></a> 375 -- initilize the weather_event wml array which defines at which turns the weather changes.
<a id='L376' name='L376'></a> 376 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("prestart", function()
<a id='L377' name='L377'></a> 377         local <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(4,6)
<a id='L378' name='L378'></a> 378         local <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a> = 0
<a id='L379' name='L379'></a> 379         local <a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a> = <em class='brace'>{</em>
<a id='L380' name='L380'></a> 380                 <em class='brace'>{</em> <a href='../Y/20485.html' title='Multiple used in 25 places.'>turns_left</a> = 10, <a href='../D/8581.html' title='Multiple defined in 22 places.'>id</a> = "drought"<em class='brace'>}</em>,
<a id='L381' name='L381'></a> 381                 <em class='brace'>{</em> <a href='../Y/20485.html' title='Multiple used in 25 places.'>turns_left</a> = 12, <a href='../D/8581.html' title='Multiple defined in 22 places.'>id</a> = "heavy rain"<em class='brace'>}</em>,
<a id='L382' name='L382'></a> 382                 <em class='brace'>{</em> <a href='../Y/20485.html' title='Multiple used in 25 places.'>turns_left</a> = 9, <a href='../D/8581.html' title='Multiple defined in 22 places.'>id</a> = "snowfall"<em class='brace'>}</em>,
<a id='L383' name='L383'></a> 383         <em class='brace'>}</em>
<a id='L384' name='L384'></a> 384         local <a href='../Y/7337.html' title='Multiple used in 3 places.'>clear_turns_left</a> = 22
<a id='L385' name='L385'></a> 385         local <a href='../Y/11306.html' title='Multiple used in 4 places.'>heavy_snowfall_turns_left</a> = 6
<a id='L386' name='L386'></a> 386         <strong class='reserved'>while</strong> <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> &lt; 55 and #<a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a> &gt; 0 <strong class='reserved'>do</strong>
<a id='L387' name='L387'></a> 387                 -- pick a random weather except 'clear' and 'heavy snow'
<a id='L388' name='L388'></a> 388                 local <a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(#<a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a>)
<a id='L389' name='L389'></a> 389                 local <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a> = <a href='../S/4170.html#L368' title='Defined at 368 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>get_weather_duration</a>(<a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a>[<a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>].<a href='../Y/20485.html' title='Multiple used in 25 places.'>turns_left</a>)
<a id='L390' name='L390'></a> 390                 local <a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> = <a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a>[<a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>].<a href='../D/8581.html' title='Multiple defined in 22 places.'>id</a>
<a id='L391' name='L391'></a> 391                 <a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a>[<a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>].<a href='../Y/20485.html' title='Multiple used in 25 places.'>turns_left</a> = weather_to_dispense[index].turns_left - <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a>
<a id='L392' name='L392'></a> 392                 <strong class='reserved'>if</strong> <a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a>[<a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>].<a href='../Y/20485.html' title='Multiple used in 25 places.'>turns_left</a> &lt;= 0 then
<a id='L393' name='L393'></a> 393                         table.remove(<a href='../Y/21566.html' title='Multiple used in 8 places.'>weather_to_dispense</a>, <a href='../D/8765.html' title='Multiple defined in 6 places.'>index</a>)
<a id='L394' name='L394'></a> 394                 end
<a id='L395' name='L395'></a> 395                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>(string.format("weather_event[%d]", <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a>), <em class='brace'>{</em>
<a id='L396' name='L396'></a> 396                         <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn,
<a id='L397' name='L397'></a> 397                         <a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> = weather_id,
<a id='L398' name='L398'></a> 398                 <em class='brace'>}</em>)
<a id='L399' name='L399'></a> 399                 <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a> = event_num + 1
<a id='L400' name='L400'></a> 400                 <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn + <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a>
<a id='L401' name='L401'></a> 401                 -- Second snow happens half the time.
<a id='L402' name='L402'></a> 402                 <strong class='reserved'>if</strong> <a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> == "snowfall" and <a href='../Y/11306.html' title='Multiple used in 4 places.'>heavy_snowfall_turns_left</a> &gt;= 0 and <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/16756.html' title='Multiple used in 60 places.'>random</a>(2) == 2 then
<a id='L403' name='L403'></a> 403                         <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a> = <a href='../S/4170.html#L368' title='Defined at 368 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>get_weather_duration</a>(<a href='../Y/11306.html' title='Multiple used in 4 places.'>heavy_snowfall_turns_left</a>)
<a id='L404' name='L404'></a> 404                         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>(string.format("weather_event[%d]", <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a>), <em class='brace'>{</em>
<a id='L405' name='L405'></a> 405                                 <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn,
<a id='L406' name='L406'></a> 406                                 <a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> = "heavy snowfall",
<a id='L407' name='L407'></a> 407                         <em class='brace'>}</em>)
<a id='L408' name='L408'></a> 408                         <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a> = event_num + 1
<a id='L409' name='L409'></a> 409                         <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn + <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a>
<a id='L410' name='L410'></a> 410                         <a href='../Y/11306.html' title='Multiple used in 4 places.'>heavy_snowfall_turns_left</a> = heavy_snowfall_turns_left - <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a>
<a id='L411' name='L411'></a> 411                 end
<a id='L412' name='L412'></a> 412                 -- Go back to clear weather.
<a id='L413' name='L413'></a> 413                 <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a> = <a href='../S/4170.html#L368' title='Defined at 368 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>get_weather_duration</a>(<a href='../Y/7337.html' title='Multiple used in 3 places.'>clear_turns_left</a>)
<a id='L414' name='L414'></a> 414                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>(string.format("weather_event[%d]", <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a>), <em class='brace'>{</em>
<a id='L415' name='L415'></a> 415                         <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn,
<a id='L416' name='L416'></a> 416                         <a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> = "clear",
<a id='L417' name='L417'></a> 417                 <em class='brace'>}</em>)
<a id='L418' name='L418'></a> 418                 <a href='../Y/9486.html' title='Multiple used in 7 places.'>event_num</a> = event_num + 1
<a id='L419' name='L419'></a> 419                 <a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> = turn + <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a>
<a id='L420' name='L420'></a> 420                 <a href='../Y/7337.html' title='Multiple used in 3 places.'>clear_turns_left</a> = clear_turns_left - <a href='../D/11392.html' title='Multiple defined in 3 places.'>num_turns</a>
<a id='L421' name='L421'></a> 421         end
<a id='L422' name='L422'></a> 422 end)
<a id='L423' name='L423'></a> 423 
<a id='L424' name='L424'></a> 424 local function <a href='../R/14705.html' title='Multiple referred from 5 places.'>weather_alert</a>(<a href='../D/15020.html' title='Multiple defined in 14 places.'>text</a>, <a href='../Y/17018.html' title='Multiple used in 237 places.'>red</a>, <a href='../Y/10992.html' title='Multiple used in 237 places.'>green</a>, <a href='../Y/6414.html' title='Multiple used in 236 places.'>blue</a>)
<a id='L425' name='L425'></a> 425         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/12033.html' title='Multiple defined in 16 places.'>print</a> <em class='brace'>{</em>
<a id='L426' name='L426'></a> 426                 <a href='../D/15020.html' title='Multiple defined in 14 places.'>text</a> = text,
<a id='L427' name='L427'></a> 427                 <a href='../D/5715.html' title='Multiple defined in 4 places.'>duration</a> = 120,
<a id='L428' name='L428'></a> 428                 <a href='../D/14440.html' title='Multiple defined in 17 places.'>size</a> = 26,
<a id='L429' name='L429'></a> 429                 <a href='../Y/17018.html' title='Multiple used in 237 places.'>red</a> = red,
<a id='L430' name='L430'></a> 430                 <a href='../Y/10992.html' title='Multiple used in 237 places.'>green</a> = green,
<a id='L431' name='L431'></a> 431                 <a href='../Y/6414.html' title='Multiple used in 236 places.'>blue</a> = blue,
<a id='L432' name='L432'></a> 432         <em class='brace'>}</em>
<a id='L433' name='L433'></a> 433 end
<a id='L434' name='L434'></a> 434 
<a id='L435' name='L435'></a> 435 local function <a href='../R/14706.html' title='Multiple referred from 5 places.'>weather_map</a>(<a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a>)
<a id='L436' name='L436'></a> 436         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../Y/19597.html' title='Multiple used in 8 places.'>terrain_mask</a> <em class='brace'>{</em>
<a id='L437' name='L437'></a> 437                 <a href='../D/10734.html' title='Multiple defined in 4 places.'>mask</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/12315.html' title='Multiple defined in 3 places.'>read_file</a>(<a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a>),
<a id='L438' name='L438'></a> 438                 <a href='../D/16456.html' title='Multiple defined in 2 places.'>x</a> = 1,
<a id='L439' name='L439'></a> 439                 <a href='../D/16471.html' title='Multiple defined in 8 places.'>y</a> = 1,
<a id='L440' name='L440'></a> 440                 <a href='../S/1247.html#L273' title='Defined at 273 in src/theme.hpp.'>border</a> = true,
<a id='L441' name='L441'></a> 441         <em class='brace'>}</em>
<a id='L442' name='L442'></a> 442         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/12463.html' title='Multiple defined in 9 places.'>redraw</a> <em class='brace'>{</em><em class='brace'>}</em>
<a id='L443' name='L443'></a> 443 end
<a id='L444' name='L444'></a> 444 
<a id='L445' name='L445'></a> 445 -- change weather at side 3 turns, TODO: consider the <strong class='reserved'>case</strong> that side 3 is empty.
<a id='L446' name='L446'></a> 446 <a href='../S/5548.html#L19' title='Defined at 19 in data/lua/on_event.lua.'>on_event</a>("side 3 turn", function()
<a id='L447' name='L447'></a> 447         -- get next weather event
<a id='L448' name='L448'></a> 448         local <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a> = <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../S/1093.html#L62' title='Defined at 62 in src/game_data.cpp.'>get_variable</a>("weather_event[0]")
<a id='L449' name='L449'></a> 449         <strong class='reserved'>if</strong> <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/5113.html' title='Multiple defined in 4 places.'>current</a>.<a href='../D/15321.html' title='Multiple defined in 2 places.'>turn</a> ~= <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.turn then
<a id='L450' name='L450'></a> 450                 <strong class='reserved'>return</strong>
<a id='L451' name='L451'></a> 451         end
<a id='L452' name='L452'></a> 452         -- remove the to-be-consumed weather event from the todo list.
<a id='L453' name='L453'></a> 453         <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../D/14101.html' title='Multiple defined in 3 places.'>set_variable</a>("weather_event[0]")
<a id='L454' name='L454'></a> 454         <strong class='reserved'>if</strong> <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.<a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> == "clear" then
<a id='L455' name='L455'></a> 455                 <a href='../S/4170.html#L435' title='Defined at 435 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_map</a>("multiplayer/maps/Dark_Forecast_basic.map")
<a id='L456' name='L456'></a> 456                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/14499.html' title='Multiple defined in 8 places.'>sound</a> <em class='brace'>{</em>
<a id='L457' name='L457'></a> 457                         <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "magic-holy-miss-2.ogg",
<a id='L458' name='L458'></a> 458                 <em class='brace'>}</em>
<a id='L459' name='L459'></a> 459                 <a href='../S/4170.html#L424' title='Defined at 424 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_alert</a>(<a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a>"Clear Weather", 221, 253, 171)
<a id='L460' name='L460'></a> 460         elseif <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.<a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> == "drought" then
<a id='L461' name='L461'></a> 461                 <a href='../S/4170.html#L435' title='Defined at 435 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_map</a> ("multiplayer/maps/Dark_Forecast_drought.map")
<a id='L462' name='L462'></a> 462                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/14499.html' title='Multiple defined in 8 places.'>sound</a> <em class='brace'>{</em>
<a id='L463' name='L463'></a> 463                         <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "gryphon-shriek-1.ogg",
<a id='L464' name='L464'></a> 464                 <em class='brace'>}</em>
<a id='L465' name='L465'></a> 465                 <a href='../S/4170.html#L424' title='Defined at 424 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_alert</a>(<a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a>"Drought", 251, 231, 171)
<a id='L466' name='L466'></a> 466         elseif <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.<a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> == "heavy rain" then
<a id='L467' name='L467'></a> 467                 <a href='../S/4170.html#L435' title='Defined at 435 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_map</a>("multiplayer/maps/Dark_Forecast_rain.map")
<a id='L468' name='L468'></a> 468                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/14499.html' title='Multiple defined in 8 places.'>sound</a> <em class='brace'>{</em>
<a id='L469' name='L469'></a> 469                         <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "magic-faeriefire-miss.ogg",
<a id='L470' name='L470'></a> 470                 <em class='brace'>}</em>
<a id='L471' name='L471'></a> 471                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../S/687.html#L287' title='Defined at 287 in src/video.cpp.'>delay</a> <em class='brace'>{</em>
<a id='L472' name='L472'></a> 472                         <a href='../D/15079.html' title='Multiple defined in 4 places.'>time</a> = 250,
<a id='L473' name='L473'></a> 473                 <em class='brace'>}</em>
<a id='L474' name='L474'></a> 474                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/14499.html' title='Multiple defined in 8 places.'>sound</a> <em class='brace'>{</em>
<a id='L475' name='L475'></a> 475                         <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "ambient/ship.ogg",
<a id='L476' name='L476'></a> 476                 <em class='brace'>}</em>
<a id='L477' name='L477'></a> 477                 <a href='../S/4170.html#L424' title='Defined at 424 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_alert</a>(<a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a>"Heavy Rains", 174, 220, 255)
<a id='L478' name='L478'></a> 478         elseif <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.<a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> == "snowfall" then
<a id='L479' name='L479'></a> 479                 <a href='../S/4170.html#L435' title='Defined at 435 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_map</a>("multiplayer/maps/Dark_Forecast_firstsnow.map")
<a id='L480' name='L480'></a> 480                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/14499.html' title='Multiple defined in 8 places.'>sound</a> <em class='brace'>{</em>
<a id='L481' name='L481'></a> 481                         <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "wail.wav",
<a id='L482' name='L482'></a> 482                 <em class='brace'>}</em>
<a id='L483' name='L483'></a> 483                 <a href='../S/4170.html#L424' title='Defined at 424 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_alert</a>(<a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a>"Snowfall", 229, 243, 241)
<a id='L484' name='L484'></a> 484         elseif <a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.<a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a> == "heavy snowfall" then
<a id='L485' name='L485'></a> 485                 <a href='../S/4170.html#L435' title='Defined at 435 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_map</a>("multiplayer/maps/Dark_Forecast_secondsnow.map")
<a id='L486' name='L486'></a> 486                 <a href='../Y/21570.html' title='Multiple used in 2575 places.'>wesnoth</a>.<a href='../Y/21753.html' title='Multiple used in 202 places.'>wml_actions</a>.<a href='../D/14499.html' title='Multiple defined in 8 places.'>sound</a> <em class='brace'>{</em>
<a id='L487' name='L487'></a> 487                         <a href='../D/11204.html' title='Multiple defined in 26 places.'>name</a> = "bat-flapping.wav",
<a id='L488' name='L488'></a> 488                 <em class='brace'>}</em>
<a id='L489' name='L489'></a> 489                 <a href='../S/4170.html#L424' title='Defined at 424 in data/multiplayer/scenarios/2p_Dark_Forecast.lua.'>weather_alert</a>(<a href='../D/2618.html' title='Multiple defined in 3 places.'>_</a>"Heavy Snowfall", 224, 255, 251)
<a id='L490' name='L490'></a> 490         <strong class='reserved'>else</strong>
<a id='L491' name='L491'></a> 491                 <a href='../D/5921.html' title='Multiple defined in 22 places.'>error</a>("unknown weather '" .. <a href='../S/1173.html#L454' title='Defined at 454 in src/lua/lvm.cpp.'>tostring</a>(<a href='../Y/21564.html' title='Multiple used in 8 places.'>weather_event</a>.<a href='../Y/21565.html' title='Multiple used in 11 places.'>weather_id</a>) .. "'")
<a id='L492' name='L492'></a> 492         end
<a id='L493' name='L493'></a> 493 end)
<a id='L494' name='L494'></a> 494 
<a id='L495' name='L495'></a> 495 
</pre>
<hr />
<a id='BOTTOM' name='BOTTOM'></a>
<em class='comment'>/* [&lt;][&gt;]<a href='#L94'>[^]</a><a href='#L435'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
</body>
</html>
